\-Basics\-:


\begin{DoxyItemize}
\item \doxyref{\-Our \-First '\-Hello \-World' \-Program}{p.}{ex_hello_world}
\item \doxyref{\-Using \-Cpp\-C\-M\-S template system}{p.}{ex_templates}
\item \doxyref{\-Using nice \-U\-R\-Ls and a mapping between modules and \-U\-R\-Ls}{p.}{ex_url_mapping}
\item \doxyref{\-Using applications hierarchy and \-U\-R\-L mapping}{p.}{ex_hierarchy}
\item \doxyref{\-Views \-Inheritance}{p.}{ex_templates_inheritance}
\end{DoxyItemize}

\-Forms\-:


\begin{DoxyItemize}
\item \doxyref{\-Using \-Cpp\-C\-M\-S forms}{p.}{ex_forms}
\item \doxyref{\-Uploading files with \-Cpp\-C\-M\-S}{p.}{ex_uploads}
\end{DoxyItemize}

\-Important \-Tasks\-:


\begin{DoxyItemize}
\item \doxyref{\-Using \-Cpp\-C\-M\-S \-Cache}{p.}{ex_basic_cache}
\item \doxyref{\-Localizing \-Cpp\-C\-M\-S \-Applications}{p.}{ex_localization}
\item \doxyref{\-Using \-Sessions}{p.}{ex_sessions}
\item \doxyref{\-Using \-Serialization \-Services}{p.}{ex_serialization}
\end{DoxyItemize}

\-Security\-:


\begin{DoxyItemize}
\item \doxyref{\-X\-S\-S filters and their use example}{p.}{ex_xss}
\end{DoxyItemize}

\-J\-S\-O\-N\-:


\begin{DoxyItemize}
\item \doxyref{\-Using \-J\-S\-O\-N \-A\-P\-I}{p.}{ex_json}
\item \doxyref{\-Simple \-Json\-R\-P\-C example}{p.}{ex_json_rpc}
\end{DoxyItemize}

\-Comet\-:


\begin{DoxyItemize}
\item \doxyref{\-Basic \-Comet \-Example}{p.}{ex_chat}
\item \doxyref{\-Implementing chat using asynchronous \-J\-S\-O\-N \-R\-P\-C calls}{p.}{ex_json_rpc_chat}
\item \doxyref{\-Asynchonous \-I/\-O examples}{p.}{ex_aio}
\end{DoxyItemize}

\-Applications\-:


\begin{DoxyItemize}
\item \doxyref{\-Full \-Message \-Board \-Application \-Example using \-Cache, \-Sessions, \-Cpp\-D\-B library and more}{p.}{ex_message_board} 
\end{DoxyItemize}\section{\-Our \-First '\-Hello \-World' \-Program}\label{ex_hello_world}

\begin{DoxyItemize}
\item \doxyref{hello\-\_\-world/\-Makefile \-Makefile}{p.}{ex_hello_world____Makefile}
\item \doxyref{hello\-\_\-world/config.\-js \-Configuration \-File}{p.}{ex_hello_world____config__js}
\item \doxyref{hello\-\_\-world/hello.\-cpp \-Source \-File}{p.}{ex_hello_world____hello__cpp} 
\end{DoxyItemize}\subsection{hello\-\_\-world/\-Makefile \-Makefile}\label{ex_hello_world____Makefile}

\begin{DoxyCodeInclude}
LIBS=-lcppcms -lbooster


all: hello

hello: hello.cpp
        $(CXX) -O2 -Wall -g hello.cpp -o hello ${LIBS}

clean:
        rm -fr hello hello.exe cppcms_rundir
\end{DoxyCodeInclude}
 \subsection{hello\-\_\-world/config.js \-Configuration \-File}\label{ex_hello_world____config__js}

\begin{DoxyCodeInclude}
{
        "service" : {
                "api" : "http",
                "port" : 8080
        },
        "http" : {
                "script" : "/hello"
        }
}

\end{DoxyCodeInclude}
 \subsection{hello\-\_\-world/hello.cpp \-Source \-File}\label{ex_hello_world____hello__cpp}

\begin{DoxyCodeInclude}
#include <cppcms/application.h>
#include <cppcms/applications_pool.h>
#include <cppcms/service.h>
#include <cppcms/http_response.h>
#include <iostream>

class my_hello_world : public cppcms::application {
public:
    my_hello_world(cppcms::service &srv) :
        cppcms::application(srv) 
    {
    }
    virtual void main(std::string url);
};

void my_hello_world::main(std::string /*url*/)
{
    response().out()<<
        "<html>\n"
        "<body>\n"
        "  <h1>Hello World</h1>\n"
        "</body>\n"
        "</html>\n";
}

int main(int argc,char ** argv)
{
    try {
        cppcms::service srv(argc,argv);
        srv.applications_pool().mount(
      cppcms::applications_factory<my_hello_world>());
        srv.run();
    }
    catch(std::exception const &e) {
        std::cerr<<e.what()<<std::endl;
    }
}
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \section{\-Using \-Cpp\-C\-M\-S template system}\label{ex_templates}

\begin{DoxyItemize}
\item \doxyref{templates/content.\-h \-Header \-File}{p.}{ex_templates____content__h}
\item \doxyref{templates/\-Makefile \-Makefile for static templates linking}{p.}{ex_templates____Makefile}
\item \doxyref{templates/config-\/dyn.\-js \-Configuration \-File for dynamic templates loading}{p.}{ex_templates____config-dyn__js}
\item \doxyref{templates/first.\-tmpl \-Template \-File}{p.}{ex_templates____first__tmpl}
\item \doxyref{templates/hello-\/tmpl.\-cpp \-Source \-File}{p.}{ex_templates____hello-tmpl__cpp}
\item \doxyref{templates/config.\-js \-Configuration \-File for static templates linking}{p.}{ex_templates____config__js}
\item \doxyref{templates/\-Makefile.\-dyn \-Makefile for dynamic templates loading}{p.}{ex_templates____Makefile__dyn} 
\end{DoxyItemize}\subsection{templates/content.h \-Header \-File}\label{ex_templates____content__h}

\begin{DoxyCodeInclude}
#ifndef CONTENT_H
#define CONTENT_H

#include <cppcms/view.h>
#include <string>

namespace content  {
    struct message : public cppcms::base_content {
        std::string text;
    };
}


#endif
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \subsection{templates/\-Makefile \-Makefile for static templates linking}\label{ex_templates____Makefile}

\begin{DoxyCodeInclude}
LIBS=-lcppcms -lbooster

all: clean hello-tmpl

hello-tmpl: hello-tmpl.cpp my_skin.cpp content.h
        $(CXX) -Wall hello-tmpl.cpp my_skin.cpp -o hello-tmpl ${LIBS}

my_skin.cpp: first.tmpl content.h
        cppcms_tmpl_cc first.tmpl -o my_skin.cpp

clean:
        rm -fr hello-tmpl *.exe *.so my_skin.cpp cppcms_rundir

\end{DoxyCodeInclude}
 \subsection{templates/config-\/dyn.js \-Configuration \-File for dynamic templates loading}\label{ex_templates____config-dyn__js}

\begin{DoxyCodeInclude}
{
        "service" : {
                "api" : "http",
                "port" : 8080
        },
        "http" : {
                "script" : "/hello"
        },
        "views" : {
                "paths" : [ "." ],
                "skins" : [ "my_skin" ]
        }
}
\end{DoxyCodeInclude}
 \subsection{templates/first.tmpl \-Template \-File}\label{ex_templates____first__tmpl}

\begin{DoxyCodeInclude}
<% c++ #include "content.h" %>
<% skin my_skin %>
<% view message uses content::message %>
<% template render() %>
<html>
<body>
<h1><%= text %> World!</h1>
</body>
<html>
<% end template %>
<% end view %>
<% end skin %>
\end{DoxyCodeInclude}
 \subsection{templates/hello-\/tmpl.cpp \-Source \-File}\label{ex_templates____hello-tmpl__cpp}

\begin{DoxyCodeInclude}
#include <cppcms/application.h>
#include <cppcms/applications_pool.h>
#include <cppcms/service.h>
#include <cppcms/http_response.h>
#include <cppcms/url_dispatcher.h>
#include <iostream>

#include "content.h"

class my_hello_world : public cppcms::application {
public:
    my_hello_world(cppcms::service &s) :
       cppcms::application(s)
    {
    }
    virtual void main(std::string /*url*/)
    {
        content::message c;
        c.text=">>>Hello<<<";
        render("message",c);
    }
};



int main(int argc,char ** argv)
{
    try {
        cppcms::service srv(argc,argv);
        srv.applications_pool().mount(
      cppcms::applications_factory<my_hello_world>());
        srv.run();
    }
    catch(std::exception const &e) {
        std::cerr<<e.what()<<std::endl;
    }
}
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4

\end{DoxyCodeInclude}
 \subsection{templates/config.js \-Configuration \-File for static templates linking}\label{ex_templates____config__js}

\begin{DoxyCodeInclude}
{
        "service" : {
                "api" : "http",
                "port" : 8080
        },
        "http" : {
                "script" : "/hello"
        }
}
\end{DoxyCodeInclude}
 \subsection{templates/\-Makefile.dyn \-Makefile for dynamic templates loading}\label{ex_templates____Makefile__dyn}

\begin{DoxyCodeInclude}
LIBS=-lcppcms -lbooster

all: clean hello-tmpl libmy_skin.so

my_skin.cpp: first.tmpl
        cppcms_tmpl_cc first.tmpl -o my_skin.cpp

libmy_skin.so: content.h my_skin.cpp
        g++ -shared -fPIC my_skin.cpp -o libmy_skin.so ${LIBS}

hello-tmpl: hello-tmpl.cpp 
        g++ -Wall -rdynamic hello-tmpl.cpp -o hello-tmpl ${LIBS}

clean:
        rm -f *.fcgi *.exe my_skin.cpp *.so hello-tmpl
\end{DoxyCodeInclude}
 \section{\-Using nice \-U\-R\-Ls and a mapping between modules and \-U\-R\-Ls}\label{ex_url_mapping}

\begin{DoxyItemize}
\item \doxyref{url\-\_\-mapping/\-Makefile \-Makefile}{p.}{ex_url_mapping____Makefile}
\item \doxyref{url\-\_\-mapping/config.\-js \-Configuration \-File}{p.}{ex_url_mapping____config__js}
\item \doxyref{url\-\_\-mapping/hello.\-cpp \-Source \-File}{p.}{ex_url_mapping____hello__cpp} 
\end{DoxyItemize}\subsection{url\-\_\-mapping/\-Makefile \-Makefile}\label{ex_url_mapping____Makefile}

\begin{DoxyCodeInclude}
LIBS=-lcppcms -lbooster

all: clean hello

hello: hello.cpp
        $(CXX) $(CXXFLAGS) -Wall hello.cpp -o hello $(LIBS)

clean:
        rm -fr hello *.exe *.so cppcms_rundir
\end{DoxyCodeInclude}
 \subsection{url\-\_\-mapping/config.js \-Configuration \-File}\label{ex_url_mapping____config__js}

\begin{DoxyCodeInclude}
{
        "service" : {
                "api" : "http",
                "port" : 8080
        },
        "http" : {
                "script" : "/hello"
        }
}
\end{DoxyCodeInclude}
 \subsection{url\-\_\-mapping/hello.cpp \-Source \-File}\label{ex_url_mapping____hello__cpp}

\begin{DoxyCodeInclude}
#include <cppcms/application.h>
#include <cppcms/service.h>
#include <cppcms/http_response.h>
#include <cppcms/url_dispatcher.h>
#include <cppcms/url_mapper.h>
#include <cppcms/applications_pool.h>
#include <iostream>
#include <stdlib.h>


class hello: public cppcms::application {
public:
    hello(cppcms::service &srv) :
        cppcms::application(srv) 
    {
        dispatcher().assign("/number/(\\d+)",&hello::number,this,1);
        mapper().assign("number","/number/{1}");
        
        dispatcher().assign("/smile",&hello::smile,this);
        mapper().assign("smile","/smile");

        dispatcher().assign("",&hello::welcome,this);
        mapper().assign("");

        mapper().root("/hello");
    }
    void number(std::string num)
    {
        int no = atoi(num.c_str());
        response().out() << "The number is " << no << "<br/>\n";
        response().out() << "<a href='" << url("/") << "'>Go back</a>";
    }
    void smile()
    {
        response().out() << ":-) <br/>\n";
        response().out() << "<a href='" << url("/") << "'>Go back</a>";
    }
    void welcome()
    {
        response().out() << 
            "<h1> Wellcome To Page with links </h1>\n"
            "<a href='" << url("/number",1)  << "'>1</a><br>\n"
            "<a href='" << url("/number",15) << "'>15</a><br>\n"
            "<a href='" << url("/smile") << "' >:-)</a><br>\n";
    }
};

int main(int argc,char ** argv)
{
    try {
        cppcms::service app(argc,argv);
        app.applications_pool().mount(cppcms::applications_factory<hello>());
        app.run();
    }
    catch(std::exception const &e) {
        std::cerr<<e.what()<<std::endl;
    }
}
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \section{\-Using applications hierarchy and \-U\-R\-L mapping}\label{ex_hierarchy}

\begin{DoxyItemize}
\item \doxyref{hierarchy/\-Makefile \-Makefile}{p.}{ex_hierarchy____Makefile}
\item \doxyref{hierarchy/config.\-js \-Configuration \-File}{p.}{ex_hierarchy____config__js}
\item \doxyref{hierarchy/myapp.\-cpp \-Source \-File}{p.}{ex_hierarchy____myapp__cpp} 
\end{DoxyItemize}\subsection{hierarchy/\-Makefile \-Makefile}\label{ex_hierarchy____Makefile}

\begin{DoxyCodeInclude}
LIBS=-lcppcms -lbooster

all: clean myapp

myapp: myapp.cpp
        $(CXX) $(CXXFLAGS) -Wall myapp.cpp -o myapp $(LIBS)

clean:
        rm -fr myapp *.exe *.so cppcms_rundir
\end{DoxyCodeInclude}
 \subsection{hierarchy/config.js \-Configuration \-File}\label{ex_hierarchy____config__js}

\begin{DoxyCodeInclude}
{
        "service" : {
                "api" : "http",
                "port" : 8080
        },
        "http" : {
                "script" : "/myapp"
        }
}
\end{DoxyCodeInclude}
 \subsection{hierarchy/myapp.cpp \-Source \-File}\label{ex_hierarchy____myapp__cpp}

\begin{DoxyCodeInclude}
#include <cppcms/application.h>
#include <cppcms/service.h>
#include <cppcms/http_response.h>
#include <cppcms/url_dispatcher.h>
#include <cppcms/url_mapper.h>
#include <cppcms/applications_pool.h>
#include <iostream>
#include <stdlib.h>


class numbers : public cppcms::application {
public:
    numbers(cppcms::service &srv) : cppcms::application(srv)
    {
        dispatcher().assign("",&numbers::all,this);
        mapper().assign("");

        dispatcher().assign("/odd",&numbers::odd,this);
        mapper().assign("odd","/odd");

        dispatcher().assign("/even",&numbers::even,this);
        mapper().assign("even","/even");

        dispatcher().assign("/prime",&numbers::prime,this);
        mapper().assign("prime","/prime");
    }

    void all()
    {
        response().out() 
            << "<a href='" << url("/")       << "'>Top</a><br>"
            << "<a href='" << url("/letters")<< "'>Letters</a><br>"
            << "<a href='" << url(".")       << "'>All Numbers</a><br>"
            << "<a href='" << url("odd")     << "'>Odd Numbers</a><br>"
            << "<a href='" << url("even")    << "'>Even Numbers</a><br>"
            << "<a href='" << url("prime")   << "'>Prime Numbers</a><br>"
            << "1,2,3,4,5,6,7,8,9,10,...";
    }

    void prime()
    {
        response().out() << "2,3,5,7,...";
    }
    void odd()
    {
        response().out() << "1,3,5,7,9,...";
    }
    void even()
    {
        response().out() << "2,4,6,8,10,...";
    }
};

class letters : public cppcms::application {
public:
    letters(cppcms::service &srv) : cppcms::application(srv)
    {
        dispatcher().assign("",&letters::all,this);
        mapper().assign("");

        dispatcher().assign("/capital",&letters::capital,this);
        mapper().assign("capital","/capital");

        dispatcher().assign("/small",&letters::small,this);
        mapper().assign("small","/small");

    }

    void all()
    {
        response().out() 
            << "<a href='" << url("/")       << "'>Top</a><br>"
            << "<a href='" << url("/numbers")<< "'>Numbers</a><br>"
            << "<a href='" << url(".")       << "'>All Letters</a><br>"
            << "<a href='" << url("capital") << "'>Capital Letters</a><br>"
            << "<a href='" << url("small")   << "'>Small Letters</a><br>"
            << "Aa, Bb, Cc, Dd,...";
    }

    void capital()
    {
        response().out() << "A,B,C,D,...";
    }
    void small()
    {
        response().out() << "a,b,c,d,...";
    }
};



class myapp: public cppcms::application {
public:
    myapp(cppcms::service &srv) :
        cppcms::application(srv) 
    {
        attach( new numbers(srv),
                "numbers", "/numbers{1}", // mapping
                "/numbers(/(.*))?", 1);   // dispatching
        attach( new letters(srv),
                "letters", "/letters{1}", // mapping
                "/letters(/(.*))?", 1);   // dispatching

        dispatcher().assign("",&myapp::describe,this);
        mapper().assign(""); // default URL
        
        mapper().root("/myapp");
    }
    void describe()
    {
        response().out() 
            << "<a href='" << url("/numbers")<< "'>Numbers</a><br>"
            << "<a href='" << url("/letters")<< "'>Letters</a><br>"
            << "<a href='" << url("/numbers/odd")<< "'>Odd Numbers</a><br>";
    }
};

int main(int argc,char ** argv)
{
    try {
        cppcms::service app(argc,argv);
        app.applications_pool().mount(cppcms::applications_factory<myapp>());
        app.run();
    }
    catch(std::exception const &e) {
        std::cerr<<e.what()<<std::endl;
    }
}
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \section{\-Views \-Inheritance}\label{ex_templates_inheritance}

\begin{DoxyItemize}
\item \doxyref{templates\-\_\-inheritance/content.\-h \-Header \-File}{p.}{ex_templates_inheritance____content__h}
\item \doxyref{templates\-\_\-inheritance/\-Makefile \-Makefile}{p.}{ex_templates_inheritance____Makefile}
\item \doxyref{templates\-\_\-inheritance/news.\-tmpl \-Template \-File}{p.}{ex_templates_inheritance____news__tmpl}
\item \doxyref{templates\-\_\-inheritance/page.\-tmpl \-Template \-File}{p.}{ex_templates_inheritance____page__tmpl}
\item \doxyref{templates\-\_\-inheritance/intro.\-tmpl \-Template \-File}{p.}{ex_templates_inheritance____intro__tmpl}
\item \doxyref{templates\-\_\-inheritance/config.\-js \-Configuration \-File}{p.}{ex_templates_inheritance____config__js}
\item \doxyref{templates\-\_\-inheritance/master.\-tmpl \-Template \-File}{p.}{ex_templates_inheritance____master__tmpl}
\item \doxyref{templates\-\_\-inheritance/myapp.\-cpp \-Source \-File}{p.}{ex_templates_inheritance____myapp__cpp} 
\end{DoxyItemize}\subsection{templates\-\_\-inheritance/content.h \-Header \-File}\label{ex_templates_inheritance____content__h}

\begin{DoxyCodeInclude}
#ifndef CONTENT_H
#define CONTENT_H

#include <cppcms/view.h>
#include <string>

namespace content  {
    struct master : public cppcms::base_content {
        std::string title;
    };
    struct page : public master {
        std::string page_title, page_content;
    };
    struct news : public master {
        std::list<std::string> news_list;
    };
}


#endif
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \subsection{templates\-\_\-inheritance/\-Makefile \-Makefile}\label{ex_templates_inheritance____Makefile}

\begin{DoxyCodeInclude}
LIBS=-lcppcms -lbooster

all: myapp

myapp: myapp.cpp my_skin.cpp content.h
        $(CXX) $(CXXFLAGS) -Wall myapp.cpp my_skin.cpp -o myapp ${LIBS}

my_skin.cpp: master.tmpl page.tmpl news.tmpl intro.tmpl content.h
        cppcms_tmpl_cc master.tmpl page.tmpl news.tmpl intro.tmpl -o my_skin.
      cpp

clean:
        rm -fr myapp *.exe my_skin.cpp cppcms_rundir

\end{DoxyCodeInclude}
 \subsection{templates\-\_\-inheritance/news.tmpl \-Template \-File}\label{ex_templates_inheritance____news__tmpl}

\begin{DoxyCodeInclude}
<% skin myskin %>
<% view news uses content::news extends master %>
<% template title() %><% include master::title() %> :: News<% end %>
<% template page_content() %>
<% foreach message in news_list %>
    <ul>
    <% item %>
        <li><%= message %></li>
    <% end %>
    </ul>
<% end foreach %>
<% end template %> 
<% end view %>
<% end skin %>
\end{DoxyCodeInclude}
 \subsection{templates\-\_\-inheritance/page.tmpl \-Template \-File}\label{ex_templates_inheritance____page__tmpl}

\begin{DoxyCodeInclude}
<% skin myskin %>
<% view page uses content::page extends master %>

<% template title() %><% include master::title() %> :: <%= page_title %><% end 
      %>
<% template page_content() %>
<%= page_content | raw %>
<% end template %> 
<% end view %>
<% end skin %>
\end{DoxyCodeInclude}
 \subsection{templates\-\_\-inheritance/intro.tmpl \-Template \-File}\label{ex_templates_inheritance____intro__tmpl}

\begin{DoxyCodeInclude}
<% skin myskin %>
<% view intro uses content::master extends master %>
<% template page_content() %>
<p><a href='<% url "/page" %>'>The Page</a></p>
<p><a href='<% url "/news" %>'>The News</a></p>
<% end template %> 
<% end view %>
<% end skin %>
\end{DoxyCodeInclude}
 \subsection{templates\-\_\-inheritance/config.js \-Configuration \-File}\label{ex_templates_inheritance____config__js}

\begin{DoxyCodeInclude}
{
        "service" : {
                "api" : "http",
                "port" : 8080
        },
        "http" : {
                "script" : "/myapp"
        }
}
\end{DoxyCodeInclude}
 \subsection{templates\-\_\-inheritance/master.tmpl \-Template \-File}\label{ex_templates_inheritance____master__tmpl}

\begin{DoxyCodeInclude}
<% c++ #include "content.h" %>
<% skin myskin %>
<% view master uses content::master %>

<% template title() %><%= title %><% end %>
<% template page_content() %>Override  Me<% end %>
<% template render() %>
<html>
<head>
    <title><% include title() %></title>
</head>
<body>
<h1><% include title() %></h1>
<div id="content">
<% include page_content() %>
</div>
</body>
</html>
<% end template %> 
<% end view %>
<% end skin %>
\end{DoxyCodeInclude}
 \subsection{templates\-\_\-inheritance/myapp.cpp \-Source \-File}\label{ex_templates_inheritance____myapp__cpp}

\begin{DoxyCodeInclude}
#include <cppcms/application.h>
#include <cppcms/applications_pool.h>
#include <cppcms/service.h>
#include <cppcms/http_response.h>
#include <cppcms/url_dispatcher.h>
#include <iostream>

#include "content.h"

class myapp  : public cppcms::application {
public:
    myapp(cppcms::service &s) :
       cppcms::application(s)
    {
        dispatcher().assign("",&myapp::intro,this);
        mapper().assign("");

        dispatcher().assign("/news",&myapp::news,this);
        mapper().assign("news","/news");

        dispatcher().assign("/page",&myapp::page,this);
        mapper().assign("page","/page");

        mapper().root("/myapp");
    }
    void ini(content::master &c)
    {
        c.title = "My Web Site";
    }
    void intro()
    {
        content::master c;
        ini(c);
        render("intro",c);
    }
    void page()
    {
        content::page c;
        ini(c);
        c.page_title = "About";
        c.page_content = "<p>A page about this web site</p>";
        render("page",c);
    }
    void news()
    {
        content::news c;
        ini(c);
        c.news_list.push_back("This is the latest message!");
        c.news_list.push_back("This is the next message.");
        c.news_list.push_back("This is the last message!");
        render("news",c);
    }
};



int main(int argc,char ** argv)
{
    try {
        cppcms::service srv(argc,argv);
        srv.applications_pool().mount(cppcms::applications_factory<myapp>());
        srv.run();
    }
    catch(std::exception const &e) {
        std::cerr<<e.what()<<std::endl;
    }
}
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4

\end{DoxyCodeInclude}
 \section{\-Using \-Cpp\-C\-M\-S forms}\label{ex_forms}

\begin{DoxyItemize}
\item \doxyref{forms/content.\-h \-Header \-File}{p.}{ex_forms____content__h}
\item \doxyref{forms/\-Makefile \-Makefile}{p.}{ex_forms____Makefile}
\item \doxyref{forms/view.\-tmpl \-Template \-File}{p.}{ex_forms____view__tmpl}
\item \doxyref{forms/config.\-js \-Configuration \-File}{p.}{ex_forms____config__js}
\item \doxyref{forms/hello.\-cpp \-Source \-File}{p.}{ex_forms____hello__cpp} 
\end{DoxyItemize}\subsection{forms/content.h \-Header \-File}\label{ex_forms____content__h}

\begin{DoxyCodeInclude}
#ifndef CONTENT_H
#define CONTENT_H

#include <cppcms/view.h>
#include <cppcms/form.h>

#include <iostream>


namespace content  {
 
struct info_form : public cppcms::form {
    cppcms::widgets::text name;
    cppcms::widgets::radio sex;
    cppcms::widgets::select marital;
    cppcms::widgets::numeric<double> age;
    cppcms::widgets::submit submit;
    info_form()
    {
        name.message("Your Name");
        sex.message("Sex");
        marital.message("Marital Status");
        age.message("Your Age");
        submit.value("Send");
        add(name);
        add(sex);
        add(marital);
        add(age);
        add(submit);
        sex.add("Male","male");
        sex.add("Female","female");
        marital.add("Single","single");
        marital.add("Married","married");
        marital.add("Divorced","divorced");
        name.non_empty();
        age.range(0,120);
    }
    virtual bool validate()
    {
        if(!form::validate()) 
            return false;
        if(marital.selected_id()!="single" && age.value()<18) {
            marital.valid(false);
            return false;
        }
        return true;
    }
};

struct message : public cppcms::base_content {
    std::string name,state,sex;
    double age;
    info_form info;
};

} // content


#endif
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \subsection{forms/\-Makefile \-Makefile}\label{ex_forms____Makefile}

\begin{DoxyCodeInclude}
LIBS=-lcppcms -lbooster

all: clean hello 

hello: hello.cpp view.cpp content.h
        $(CXX) -Wall hello.cpp view.cpp -o hello $(LIBS)

view.cpp: view.tmpl content.h
        cppcms_tmpl_cc view.tmpl -o view.cpp

clean:
        rm -fr *.exe *.so view.cpp cppcms_rundir hello
\end{DoxyCodeInclude}
 \subsection{forms/view.tmpl \-Template \-File}\label{ex_forms____view__tmpl}

\begin{DoxyCodeInclude}
<% c++ #include "content.h" %>
<% skin view %>
<% view message uses content::message %>
<% template render() %>
<html>
    <body>
    <% if not empty name %>
            <h1>Hello <%= name %></h1>
            <p>You are <%= sex %>, <%= state %></p>
            <p>Your age is <%= age %></p>
    <% else %>
        <h1>Input your details</h1>
    <% end %>
    <form method="post" action="" >
    <% form as_p info %>
    </form>
  </body>
<html>
<% end template %>
<% end view %>
<% end skin %>
\end{DoxyCodeInclude}
 \subsection{forms/config.js \-Configuration \-File}\label{ex_forms____config__js}

\begin{DoxyCodeInclude}
{
        "service" : {
                "api" : "http",
                "port" : 8080
        },
        "http" : {
                "script" : "/hello"
        },
}
\end{DoxyCodeInclude}
 \subsection{forms/hello.cpp \-Source \-File}\label{ex_forms____hello__cpp}

\begin{DoxyCodeInclude}
#include <cppcms/application.h>
#include <cppcms/applications_pool.h>
#include <cppcms/service.h>
#include <cppcms/http_response.h>
#include <iostream>
#include "content.h"

using namespace std;
class hello: public cppcms::application {
public:
    hello(cppcms::service &s) :
        cppcms::application(s) 
    {
    }

    void main(std::string /*unused*/)
    {
        content::message c;
        if(request().request_method()=="POST") {
            c.info.load(context());
            if(c.info.validate()) {
                c.name=c.info.name.value();
                c.sex=c.info.sex.selected_id();
                c.state=c.info.marital.selected_id();
                c.age=c.info.age.value();
                c.info.clear();
            }
        }
        render("message",c);
    }
};

int main(int argc,char ** argv)
{
    try {
        cppcms::service app(argc,argv);
        app.applications_pool().mount(cppcms::applications_factory<hello>());
        app.run();
    }
    catch(std::exception const &e) {
        cerr<<e.what()<<endl;
    }
}


// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \section{\-Uploading files with \-Cpp\-C\-M\-S}\label{ex_uploads}

\begin{DoxyItemize}
\item \doxyref{uploads/content.\-h \-Header \-File}{p.}{ex_uploads____content__h}
\item \doxyref{uploads/\-Makefile \-Makefile}{p.}{ex_uploads____Makefile}
\item \doxyref{uploads/uploader.\-cpp \-Source \-File}{p.}{ex_uploads____uploader__cpp}
\item \doxyref{uploads/view.\-tmpl \-Template \-File}{p.}{ex_uploads____view__tmpl}
\item \doxyref{uploads/index.\-html \-Header \-File}{p.}{ex_uploads____index__html}
\item \doxyref{uploads/config.\-js \-Configuration \-File}{p.}{ex_uploads____config__js} 
\end{DoxyItemize}\subsection{uploads/content.h \-Header \-File}\label{ex_uploads____content__h}

\begin{DoxyCodeInclude}
#ifndef CONTENT_H
#define CONTENT_H

#include <cppcms/view.h>
#include <cppcms/form.h>

#include <iostream>


namespace content  {
 
struct file_form : public cppcms::form {
    cppcms::widgets::text description;
    cppcms::widgets::file image;
    cppcms::widgets::submit submit;
    file_form()
    {
        description.message("Image Description");
        description.non_empty();
        
        image.message("Image to upload");
        image.help("PNG or JPEG only allowed under 100Kb");
        image.non_empty();

        // Sanity checks on the image

        // size 100k
        image.limits(0,100*1024);
        // Filename with proper extension (optional)
        image.filename(booster::regex(".*\\.(jpg|jpeg|png)"));
        // Correct mime type (optional)
        image.mime(booster::regex("image/(png|jpeg)"));

        // And the most important (more then two above) the
        // magic numbers for each file and this the most important
        // validation
        //
        // Note: this what really defines the file type, other can be
        // easily changed
        image.add_valid_magic("\x89\x50\x4e\x47\x0D\x0A\x1A\x0A"); // png
        image.add_valid_magic("\xff\xd8"); // jpeg

        submit.value("Upload");

        add(description);
        add(image);
        add(submit);
    }
};

struct upload : public cppcms::base_content {
    file_form info;
};

} // content


#endif
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \subsection{uploads/\-Makefile \-Makefile}\label{ex_uploads____Makefile}

\begin{DoxyCodeInclude}
LIBS=-lcppcms -lbooster

all: clean uploader 

uploader: uploader.cpp view.cpp content.h
        $(CXX) -Wall $(CXXFLAGS) uploader.cpp view.cpp -o uploader $(LIBS)

view.cpp: view.tmpl content.h
        cppcms_tmpl_cc view.tmpl -o view.cpp

clean:
        rm -fr *.exe *.so view.cpp cppcms_rundir uploader
\end{DoxyCodeInclude}
 \subsection{uploads/uploader.cpp \-Source \-File}\label{ex_uploads____uploader__cpp}

\begin{DoxyCodeInclude}
#include <cppcms/application.h>
#include <cppcms/applications_pool.h>
#include <cppcms/service.h>
#include <cppcms/http_response.h>
#include <cppcms/http_file.h>
#include <iostream>
#include "content.h"

using namespace std;
class uploader: public cppcms::application {
public:
    uploader(cppcms::service &s) :
        cppcms::application(s) 
    {
    }

    void main(std::string /*unused*/)
    {
        content::upload c;
        if(request().request_method()=="POST") {
            c.info.load(context());
            if(c.info.validate()) {
                // Create file name
                //
                // Note:
                // NEVER, NEVER, NEVER use user supplied file name!
                //
                // Use it to display or for general information only.
                //
                // If you would try to save the file under user supplied name
       you
                // may open yourself to multiple security issues like directory
                // traversal and more.
                //
                // So create your own name. If you want to keep the connection
       with original
                // name you may use sha1 hash and then save it.
                //
                std::string new_name = "latest_image";
                if(c.info.image.value()->mime() == "image/png")
                    new_name += ".png";
                else
                    new_name += ".jpg"; // we had validated mime-type

                //
                // Note: save_to is more efficient then reading file from
                // c.info.image.value()->data() stream and writing it
                // as save to would try to move the saved file over file-system
                // and it would be more efficient.
                //
                c.info.image.value()->save_to("./uploads/" + new_name); 
                c.info.clear();
            }
        }
        render("upload",c);
    }
};

int main(int argc,char ** argv)
{
    try {
        cppcms::service app(argc,argv);
        app.applications_pool().mount(cppcms::applications_factory<uploader>())
      ;
        app.run();
    }
    catch(std::exception const &e) {
        cerr<<e.what()<<endl;
    }
}


// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \subsection{uploads/view.tmpl \-Template \-File}\label{ex_uploads____view__tmpl}

\begin{DoxyCodeInclude}
<% c++ #include "content.h" %>
<% skin view %>
<% view upload uses content::upload %>
<% template render() %>
<html>
   <body>
    <!-- Specify enctype="multipart/form-data" to be able to upload files -->

    <form method="post" action="" enctype="multipart/form-data" >
    <% form as_p info %>
    </form>
   <p>Uploaded images</p>
   <iframe src="/uploads/" width='800' height='300'></iframe>
  </body>
<html>
<% end template %>
<% end view %>
<% end skin %>
\end{DoxyCodeInclude}
 \subsection{uploads/index.html \-Header \-File}\label{ex_uploads____index__html}

\begin{DoxyCodeInclude}
<html>
<head>
<meta HTTP-EQUIV="REFRESH" content="0; url=/uploader">
</head>
<body><a href="/uploader">Follow the link</a></body>
</html>
\end{DoxyCodeInclude}
 \subsection{uploads/config.js \-Configuration \-File}\label{ex_uploads____config__js}

\begin{DoxyCodeInclude}
{
        "service" : {
                "api" : "http",
                "port" : 8080
        },
        "http" : {
                "script" : "/uploader"
        },
        "file_server" : {
                "enable" : true,
                "listing" : true,
                "document_root" : "."
        },
}
\end{DoxyCodeInclude}
 \section{\-Using \-Cpp\-C\-M\-S \-Cache}\label{ex_basic_cache}

\begin{DoxyItemize}
\item \doxyref{basic\-\_\-cache/content.\-h \-Header \-File}{p.}{ex_basic_cache____content__h}
\item \doxyref{basic\-\_\-cache/\-Makefile \-Makefile}{p.}{ex_basic_cache____Makefile}
\item \doxyref{basic\-\_\-cache/view.\-tmpl \-Template \-File}{p.}{ex_basic_cache____view__tmpl}
\item \doxyref{basic\-\_\-cache/config.\-js \-Configuration \-File}{p.}{ex_basic_cache____config__js}
\item \doxyref{basic\-\_\-cache/hello.\-cpp \-Source \-File}{p.}{ex_basic_cache____hello__cpp} 
\end{DoxyItemize}\subsection{basic\-\_\-cache/content.h \-Header \-File}\label{ex_basic_cache____content__h}

\begin{DoxyCodeInclude}
#ifndef CONTENT_H
#define CONTENT_H

#include <cppcms/view.h>
#include <cppcms/form.h>
#include <string>



namespace content  {
 
struct input_form : public cppcms::form {
    cppcms::widgets::numeric<int> arg;
    cppcms::widgets::submit submit;

    input_form()
    {
        arg.message("N");
        submit.value("Calc");
        add(arg);
        add(submit);
        arg.non_empty();
    }
};

struct message : public cppcms::base_content {
    long long int fact;
    int arg;
    input_form info;
};

}


#endif
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \subsection{basic\-\_\-cache/\-Makefile \-Makefile}\label{ex_basic_cache____Makefile}

\begin{DoxyCodeInclude}
LIBS=-lcppcms -lbooster

all: clean hello 

hello: hello.cpp view.cpp content.h
        $(CXX) -Wall hello.cpp view.cpp -o hello $(LIBS)

view.cpp: view.tmpl content.h
        cppcms_tmpl_cc view.tmpl -o view.cpp

clean:
        rm -fr hello *.exe *.so view.cpp cppcms_rundir
\end{DoxyCodeInclude}
 \subsection{basic\-\_\-cache/view.tmpl \-Template \-File}\label{ex_basic_cache____view__tmpl}

\begin{DoxyCodeInclude}
<% c++ #include "content.h" %>
<% skin view %>
<% view message uses content::message %>
<% template render() %>
<html>
    <body>
    <h1>Factorial Calculator</h1>
    <h2><%= arg %>! = <%= fact %></h2>
    <form method="post" action="" >
    <% form as_p info %>
    </form>
  </body>
<html>
<% end template %>
<% end view %>
<% end skin %>
\end{DoxyCodeInclude}
 \subsection{basic\-\_\-cache/config.js \-Configuration \-File}\label{ex_basic_cache____config__js}

\begin{DoxyCodeInclude}
{
        "service" : {
                "api" : "http",
                "port" : 8080
        },
        "http" : {
                "script" : "/hello"
        },
        "cache" : {
                "backend" : "thread_shared",
                "limit" : 100,
        }
}

\end{DoxyCodeInclude}
 \subsection{basic\-\_\-cache/hello.cpp \-Source \-File}\label{ex_basic_cache____hello__cpp}

\begin{DoxyCodeInclude}
#include <cppcms/service.h>
#include <cppcms/application.h>
#include <cppcms/applications_pool.h>
#include <cppcms/cache_interface.h>
#include <iostream>
#include <sstream>
#include "content.h"

class hello: public cppcms::application {
public:
    hello(cppcms::service &s) :
        cppcms::application(s) 
    {
    }
    void main(std::string /*unused*/)
    {
        content::message c;
        c.arg=0;
        c.fact=1;
        if(request().request_method()=="POST") {
            c.info.load(context());
            if(c.info.validate()) {
                c.arg=c.info.arg.value(); 
                c.info.clear();
            }
            else { // No cache should be used
               render("message",c);
               return;
            }
        }

        std::ostringstream key;
        key << "factorial_" << c.arg;
        if(cache().fetch_page(key.str()))
            return;
        long long int f=1;
        for(int i=1;i<=c.arg;i++) {
            f*=i;
        }
        c.fact=f;
        render("message",c);
        cache().store_page(key.str(),3600);
    }
};

int main(int argc,char ** argv)
{
    try {
        cppcms::service app(argc,argv);
        app.applications_pool().mount(cppcms::applications_factory<hello>());
        app.run();
    }
    catch(std::exception const &e) {
        std::cerr<<e.what()<<std::endl;
    }
}
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \section{\-Localizing \-Cpp\-C\-M\-S \-Applications}\label{ex_localization}

\begin{DoxyItemize}
\item \doxyref{localization/content.\-h \-Header \-File}{p.}{ex_localization____content__h}
\item \doxyref{localization/\-Makefile \-Makefile}{p.}{ex_localization____Makefile}
\item \doxyref{localization/view.\-tmpl \-Template \-File}{p.}{ex_localization____view__tmpl}
\item \doxyref{localization/config.\-js \-Configuration \-File}{p.}{ex_localization____config__js}
\item \doxyref{localization/hello.\-cpp \-Source \-File}{p.}{ex_localization____hello__cpp}
\item \doxyref{localization/locale/he/\-L\-C\-\_\-\-M\-E\-S\-S\-A\-G\-E\-S/hello.\-po \-Gettext \-Dictionary \-File}{p.}{ex_localization____locale_he_LC_MESSAGES_hello__po} 
\end{DoxyItemize}\subsection{localization/content.h \-Header \-File}\label{ex_localization____content__h}

\begin{DoxyCodeInclude}
#ifndef CONTENT_H
#define CONTENT_H

#include <cppcms/view.h>
#include <string>

namespace content  {
    struct message : public cppcms::base_content {
        std::string message;
    };
}


#endif
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \subsection{localization/\-Makefile \-Makefile}\label{ex_localization____Makefile}

\begin{DoxyCodeInclude}
LIBS=-lcppcms -lbooster

all: clean hello locale/he/LC_MESSAGES/hello.mo

hello: hello.cpp view.cpp content.h
        $(CXX) $(CXXFLAGS) -Wall hello.cpp view.cpp -o hello $(LIBS)

view.cpp: view.tmpl content.h
        cppcms_tmpl_cc -d hello view.tmpl -o view.cpp

locale/he/LC_MESSAGES/hello.mo: locale/he/LC_MESSAGES/hello.po
        msgfmt locale/he/LC_MESSAGES/hello.po -o locale/he/LC_MESSAGES/hello.mo

clean:
        rm -fr hello *.exe *.so view.cpp locale/he/LC_MESSAGES/hello.mo 
      cppcms_rundir
\end{DoxyCodeInclude}
 \subsection{localization/view.tmpl \-Template \-File}\label{ex_localization____view__tmpl}

\begin{DoxyCodeInclude}
<% c++ #include "content.h" %>
<% skin view %>
<% view message uses content::message %>
<% template render() %>
<html>
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
    </head>
    <% if rtl %>
    <body dir="rtl">
    <% else %>
    <body>
    <% end %>
    <h1><% gt "We want to say" %></h1>
    <p><%= message %></p>
    <p><a href="he_IL">he</a>/<a href="en_US">en</a></p>
  </body>
<html>
<% end template %>
<% end view %>
<% end skin %>
\end{DoxyCodeInclude}
 \subsection{localization/config.js \-Configuration \-File}\label{ex_localization____config__js}

\begin{DoxyCodeInclude}
{
        "service" : {
                "api" : "http",
                "port" : 8080
        },
        "http" : {
                "script" : "/hello"
        },
        "localization" : {
                "messages" : {
                        "paths" : [ "./locale" ],
                        "domains" : [ "hello" ]
                },
                "locales" : [ "he_IL.UTF-8", "en_US.UTF-8" ]
        }
}
\end{DoxyCodeInclude}
 \subsection{localization/hello.cpp \-Source \-File}\label{ex_localization____hello__cpp}

\begin{DoxyCodeInclude}
#include <cppcms/application.h>
#include <cppcms/service.h>
#include <cppcms/url_dispatcher.h>
#include <cppcms/applications_pool.h>
#include <iostream>
#include "content.h"


class hello: public cppcms::application {
public:
    hello(cppcms::service &srv) :
        cppcms::application(srv) 
    {
        dispatcher().assign("^/(en_US|he_IL)/?$",&hello::say_hello,this,1);
        dispatcher().assign("^(.*)$",&hello::redirect,this);
    }
    void redirect()
    {
        response().set_redirect_header(request().script_name() + "/en_US");
    }
    void say_hello(std::string lang)
    {
        context().locale(lang + ".UTF-8");
        content::message c;
        c.message=translate("Hello World");
        render("message",c);
    }
};

int main(int argc,char ** argv)
{
    try {
        cppcms::service app(argc,argv);
        app.applications_pool().mount(cppcms::applications_factory<hello>());
        app.run();
    }
    catch(std::exception const &e) {
        std::cerr<<e.what()<<std::endl;
    }
}
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \subsection{localization/locale/he/\-L\-C\-\_\-\-M\-E\-S\-S\-A\-G\-E\-S/hello.po \-Gettext \-Dictionary \-File}\label{ex_localization____locale_he_LC_MESSAGES_hello__po}

\begin{DoxyCodeInclude}
msgid ""
msgstr ""
"Content-Type: text/plain; charset=utf-8\n"
"Content-Transfer-Encoding: 8bit\n"

#: view.tmpl:6
msgid "LTR"
msgstr "RTL"

#: view.tmpl:11
msgid "We want to say"
msgstr "אנחנו רוצים לומר"

#: hello.cpp:21
msgid "Hello World"
msgstr "שלום עולם"
\end{DoxyCodeInclude}
 \section{\-Using \-Sessions}\label{ex_sessions}

\begin{DoxyItemize}
\item \doxyref{sessions/content.\-h \-Header \-File}{p.}{ex_sessions____content__h}
\item \doxyref{sessions/\-Makefile \-Makefile}{p.}{ex_sessions____Makefile}
\item \doxyref{sessions/view.\-tmpl \-Template \-File}{p.}{ex_sessions____view__tmpl}
\item \doxyref{sessions/config.\-js \-Configuration \-File}{p.}{ex_sessions____config__js}
\item \doxyref{sessions/hello.\-cpp \-Source \-File}{p.}{ex_sessions____hello__cpp} 
\end{DoxyItemize}\subsection{sessions/content.h \-Header \-File}\label{ex_sessions____content__h}

\begin{DoxyCodeInclude}
#ifndef CONTENT_H
#define CONTENT_H

#include <cppcms/view.h>
#include <cppcms/form.h>

#include <iostream>


namespace content  {
 
struct info_form : public cppcms::form {
    cppcms::widgets::text name;
    cppcms::widgets::radio sex;
    cppcms::widgets::select martial;
    cppcms::widgets::numeric<double> age;
    cppcms::widgets::submit submit;
    info_form()
    {
        name.message("Your Name");
        sex.message("Sex");
        martial.message("Martial State");
        age.message("Your Age");
        submit.value("Send");
        add(name);
        add(sex);
        add(martial);
        add(age);
        add(submit);
        sex.add("Male","m");
        sex.add("Female","f");
        martial.add("Single","s");
        martial.add("Married","m");
        martial.add("Divorced","d");
        name.non_empty();
        age.range(0,120);
    }
    virtual bool validate()
    {
        if(!form::validate()) 
            return false;
        if(martial.selected_id()!="s" && age.value()<18) {
            martial.valid(false);
            return false;
        }
        return true;
    }
};

struct message : public cppcms::base_content {
    std::string name,who;
    double age;
    info_form info;
};

} // content


#endif
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \subsection{sessions/\-Makefile \-Makefile}\label{ex_sessions____Makefile}

\begin{DoxyCodeInclude}
LIBS=-lcppcms -lbooster

all: clean hello

hello: hello.cpp view.cpp content.h
        $(CXX) -Wall hello.cpp view.cpp -o hello $(LIBS)

view.cpp: view.tmpl content.h
        cppcms_tmpl_cc view.tmpl -o view.cpp

clean:
        rm -fr hello *.exe *.so view.cpp cppcms_rundir
\end{DoxyCodeInclude}
 \subsection{sessions/view.tmpl \-Template \-File}\label{ex_sessions____view__tmpl}

\begin{DoxyCodeInclude}
<% c++ #include "content.h" %>
<% skin view %>
<% view message uses content::message %>
<% template render() %>
<html>
<body>
    <h1>Hello <%= who %> <%= name %></h1>
    <% if (content.age != -1.0) %>
        <p>Your age is <%= age %></p>
        <h2>Change details</h2>
    <% else %>
        <h2>Input your details</h2>
    <% end %>
    <form method="post" action="" >
    <% form as_p info %>
    </form>
  </body>
<html>
<% end template %>
<% end view %>
<% end skin %>
\end{DoxyCodeInclude}
 \subsection{sessions/config.js \-Configuration \-File}\label{ex_sessions____config__js}

\begin{DoxyCodeInclude}
{
        "service" : {
                "api" : "http",
                "port" : 8080
        },
        "http" : {
                "script" : "/hello"
        },
        "session" : {
                "expire" : "renew",
                "timeout" : 604800,
                "location" : "client",
                "client" :      {
                        "hmac" :        "sha1",
                        "hmac_key" :    "
      3891bbf7f845fd4277008a63d72640fc13bb9a31"
                }

        },
}
\end{DoxyCodeInclude}
 \subsection{sessions/hello.cpp \-Source \-File}\label{ex_sessions____hello__cpp}

\begin{DoxyCodeInclude}
#include <cppcms/application.h>
#include <cppcms/applications_pool.h>
#include <cppcms/service.h>
#include <cppcms/http_response.h>
#include <cppcms/url_dispatcher.h>
#include <cppcms/session_interface.h>
#include <iostream>

#include "content.h"

using namespace std;

class hello: public cppcms::application {
public:
    hello(cppcms::service &s) :
        cppcms::application(s) 
    {
    }
    void main(std::string /* unused */)
    {
        content::message c;
        if(request().request_method()=="POST") {
            c.info.load(context());
            if(c.info.validate()) {
                session()["name"]=c.info.name.value();
                session()["sex"]=c.info.sex.selected_id();
                session()["state"]=c.info.martial.selected_id();
                session().set("age",c.info.age.value());
                c.info.clear();
            }
        }

        if(session().is_set("name")) {
            c.name=session()["name"];
            if(session()["sex"]=="m") {
                c.who="Mr";
            }
            else {
                if(session()["state"]=="s") {
                    c.who="Miss";
                }
                else {
                    c.who="Mrs";
                }
            }
            c.age=session().get<double>("age");
        }
        else {
            c.name="Visitor";
            c.age=-1;
        }
        render("message",c);
    }
};

int main(int argc,char ** argv)
{
    try {
        cppcms::service app(argc,argv);
        app.applications_pool().mount(cppcms::applications_factory<hello>());
        app.run();
    }
    catch(std::exception const &e) {
        cerr<<e.what()<<endl;
    }
}
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \section{\-Using \-Serialization \-Services}\label{ex_serialization}

\begin{DoxyItemize}
\item \doxyref{serialization/\-Makefile \-Makefile}{p.}{ex_serialization____Makefile}
\item \doxyref{serialization/external\-\_\-serialization.\-cpp \-Source \-File}{p.}{ex_serialization____external_serialization__cpp}
\item \doxyref{serialization/serialization.\-cpp \-Source \-File}{p.}{ex_serialization____serialization__cpp} 
\end{DoxyItemize}\subsection{serialization/\-Makefile \-Makefile}\label{ex_serialization____Makefile}

\begin{DoxyCodeInclude}
LIBS=-lcppcms -lbooster


all: serialization external_serialization

serialization: serialization.cpp
        $(CXX) $(CXXFLAGS) -O2 -Wall -g serialization.cpp -o serialization ${
      LIBS}

external_serialization: external_serialization.cpp
        $(CXX) $(CXXFLAGS) -O2 -Wall -g external_serialization.cpp -o 
      external_serialization ${LIBS} -lboost_serialization

clean:
        rm -f *.exe serialization external_serialization
\end{DoxyCodeInclude}
 \subsection{serialization/external\-\_\-serialization.cpp \-Source \-File}\label{ex_serialization____external_serialization__cpp}

\begin{DoxyCodeInclude}
#include <cppcms/serialization.h>
#include <cppcms/application.h>
#include <cppcms/cache_interface.h>
#include <cppcms/session_interface.h>
#include <boost/archive/binary_oarchive.hpp>
#include <boost/archive/binary_iarchive.hpp>
#include <sstream>
#include <iostream>

struct person {

    std::string name;
    std::string family;

    template<typename Archive>
    void serialize(Archive &a,unsigned /*version*/)
    {
        a & name & family;
    }
};

template<typename T>
void load_from_boost(std::string const &src,T &obj)
{
    std::stringbuf ss(src);
    {
        boost::archive::binary_iarchive oa(ss);
        oa >> obj;
    }
}


template<typename T>
void save_with_boost(T const &obj,std::string &tgt)
{
    std::stringbuf ss;
    {
        boost::archive::binary_oarchive oa(ss);
        oa << obj;
    }
    tgt=ss.str();
}

void init_person(person &john)
{
    john.name = "John";
    john.family = "Jonson";
}

/* Specialize */
namespace cppcms {
    template<>
    struct serialization_traits<person> {
        static void save(person const &obj,std::string &tgt)
        {
            save_with_boost(obj,tgt);
        }
        static void load(std::string const &src,person &obj)
        {
            load_from_boost(src,obj);
        }
    };
}


class app : public cppcms::application {
public:
    app(cppcms::service &s) : cppcms::application(s)
    {
    }

    void main(std::string /*url*/)
    {
        {
            person john;
            session().fetch_data("me",john);
        }
        {
            person john;
            if(!cache().fetch_data("john",john)) {
                init_person(john);
                cache().store_data("john",john);
            }
        }
    }
};

int main()
{
    { // Generic way
        std::string buffer;
        {
            person john;
            init_person(john);
            cppcms::serialization_traits<person>::save(john,buffer);
        }
        {
            person john;
            cppcms::serialization_traits<person>::load(buffer,john);
            std::cout << john.name << std::endl;
        }

    }
    return 0;
}





// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \subsection{serialization/serialization.cpp \-Source \-File}\label{ex_serialization____serialization__cpp}

\begin{DoxyCodeInclude}
#include <cppcms/serialization.h>
#include <cppcms/application.h>
#include <cppcms/cache_interface.h>
#include <cppcms/session_interface.h>
#include <iostream>


// POD structure
struct physical {
    int age;
    double height;
};


struct child : public cppcms::serializable {
    std::string name;
    physical parameters;

        void serialize(cppcms::archive &a)
    {
        a & name & cppcms::as_pod(parameters);
    }

};

struct person : public cppcms::serializable {

    std::string name;
    std::string family;
    std::string occupation;
    std::string martial_state;
    double salary;
    physical parameters;
    std::list<child> children;
    std::vector<std::string> friends;

    void serialize(cppcms::archive &a)
    {
        a & name & family & occupation & martial_state 
          & salary & cppcms::as_pod(parameters) & children & friends;
    }
};

void init_person(person &john)
{
    john.name = "John";
    john.family = "Jonson";
    john.occupation = "Programmer";
    john.martial_state = "married";
    john.parameters.age = 30;
    john.parameters.height = 1.80;
    john.salary = 1500;
    john.children.push_back(child());
    john.children.back().name = "Tom";
    john.children.back().parameters.age = 5;
    john.children.back().parameters.height = 1.0;
    john.friends.push_back("Gorge");
}

class app : public cppcms::application {
public:
    app(cppcms::service &s) : cppcms::application(s)
    {
    }

    void main(std::string /*url*/)
    {
        {
            person me;
            if(session().is_set("me")) {
                session().fetch_data("me",me);
                me.salary += 1;
                session().store_data("me",me);
            }
        }
        {
            person john;
            if(!cache().fetch_data("john",john)) {
                init_person(john);
                cache().store_data("john",john);
            }
        }
    }
};

int main()
{
    { // Using archive directly
        std::string buffer; 
        {
            person john;
            init_person(john);
            cppcms::archive a;
            john.save(a);
            buffer = a.str();
        }
        {
            person john;
            cppcms::archive a;
            a.str(buffer);
            john.load(a);
            std::cout << john.name << " " << john.children.front().name << " " 
      << john.friends.front() << std::endl;
        }
    }
    { // Generic way
        std::string buffer;
        {
            person john;
            init_person(john);
            cppcms::serialization_traits<person>::save(john,buffer);
        }
        {
            person john;
            cppcms::serialization_traits<person>::load(buffer,john);
            std::cout << john.name << " " << john.children.front().name << " " 
      << john.friends.front() << std::endl;
        }

    }
    return 0;
}





// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \section{\-X\-S\-S filters and their use example}\label{ex_xss}

\begin{DoxyItemize}
\item \doxyref{xss/\-Makefile \-Makefile}{p.}{ex_xss____Makefile}
\item \doxyref{xss/tinymce\-\_\-profile.\-js \-Configuration \-File}{p.}{ex_xss____tinymce_profile__js}
\item \doxyref{xss/comment\-\_\-profile.\-js \-Configuration \-File}{p.}{ex_xss____comment_profile__js}
\item \doxyref{xss/xss.\-cpp \-Source \-File}{p.}{ex_xss____xss__cpp}
\item \doxyref{xss/config.\-js \-Configuration \-File}{p.}{ex_xss____config__js} 
\end{DoxyItemize}\subsection{xss/\-Makefile \-Makefile}\label{ex_xss____Makefile}

\begin{DoxyCodeInclude}
LIBS=-lcppcms -lbooster


all: xss

xss: xss.cpp
        $(CXX) $(CXXFLAGS) -O2 -Wall -g xss.cpp -o xss ${LIBS}

clean:
        rm -fr xss xss.exe cppcms_rundir
\end{DoxyCodeInclude}
 \subsection{xss/tinymce\-\_\-profile.js \-Configuration \-File}\label{ex_xss____tinymce_profile__js}

\begin{DoxyCodeInclude}
{
        //
        // Profile for simple tinymce 
        // theme with autolink plugin
        //
        "encoding" : "UTF-8",
        "entities" : [ "nbsp" ],
        "tags" : {
                "opening_and_closing" : [ 
                        "p",
                        "ul","ol","li", // lists
                        "strong", "em", 
                        "span",
                        "a"
                ],
                "stand_alone" : [ "br" , "hr" ]
        },
        "attributes" : [
                {
                        "tags" : [ "a" ],
                        "attributes" : [ "href" ],
                        "type" : "absolute_uri"
                },
                {
                        "tags" : [ "span" ],
                        "attributes" : [ "style" ],
                        "type" : "regex",
                        "expression" : "(\\s*text-decoration\\s*:\\
      s*(underline|line-through)\\s*;)*"
                }
        ]
}

\end{DoxyCodeInclude}
 \subsection{xss/comment\-\_\-profile.js \-Configuration \-File}\label{ex_xss____comment_profile__js}

\begin{DoxyCodeInclude}
{
        "encoding" : "UTF-8",
        "tags" : {
                "opening_and_closing" : [ 
                        "b", "i", "tt",
                        "strong", "em", 
                        "blockquote" ,
                        "a"
                ],
                "stand_alone" : [ "br", "hr" ]
        },
        "attributes" : [
                {
                        "tags" : [ "a" ],
                        "attributes" : [ "href" ],
                        "type" : "uri"
                }
        ]
}

\end{DoxyCodeInclude}
 \subsection{xss/xss.cpp \-Source \-File}\label{ex_xss____xss__cpp}

\begin{DoxyCodeInclude}
#include <cppcms/application.h>
#include <cppcms/applications_pool.h>
#include <cppcms/service.h>
#include <cppcms/http_response.h>
#include <cppcms/http_request.h>
#include <cppcms/filters.h>
#include <cppcms/xss.h>
#include <cppcms/json.h>
#include <iostream>


// Loading rules is expencive but once it is loaded
// we can access same object from multiple threads
// so just create one global object
cppcms::xss::rules global_rules;

class my_xss : public cppcms::application {
public:
    my_xss(cppcms::service &srv) :
        cppcms::application(srv) 
    {
    }
    virtual void main(std::string url);
};

void my_xss::main(std::string /*url*/)
{
    std::string text;

    text = request().post("xss");


    response().out() <<  
        "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.1//EN\" \"
      http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd\">"
        "<html>\n"
        "<head><title>XSS Test</title>\n";

    if(settings().get("filters.tinymce",false)==true) {
        response().out() <<
            "<script type=\"text/javascript\" src=\"
      /tinymce/jscripts/tiny_mce/tiny_mce.js\" ></script >\n"
            "<script type=\"text/javascript\" >\n"
            "tinyMCE.init({ \n"
            "  mode : \"textareas\",\n"
            "  plugins : \"autolink\",\n"
            "  theme : \"simple\" });\n"
            "</script>\n";
    }

    response().out() <<  
        "<body>\n"
        "  <h1>Test XSS Filters</h1>\n"
        "<form method='post' action='/xss'>\n"
        "<textarea name='xss' cols='80' rows='25' >" 
        << cppcms::filters::escape(text) << 
        "</textarea><br>\n"
        "<input type='submit' value='Send' />\n"
        "</form>\n"
        " <table border='1'>\n"
        "<tr><td>Original</td><td><code><pre>"
        << cppcms::filters::escape(text)
        <<"</pre></code></td></tr>\n"
        "<tr><td>Filtered</td><td><code><pre>"
        << cppcms::filters::escape(cppcms::xss::filter(text,global_rules))
        <<"</pre></code></td></tr>\n"
        "<tr><td>Filtered HTML</td><td>"
        << cppcms::xss::filter(text,global_rules)
        <<"</td></tr>\n"
        <<"</table>\n"
        "</body>\n"
        "</html>\n";
};

int main(int argc,char ** argv)
{
    try {
        cppcms::service srv(argc,argv);
        // Load rules from the profile file that the path we store in 
        // configuration file
        global_rules = cppcms::xss::rules(srv.settings().get<std::string>("
      filters.profile"));
        srv.applications_pool().mount(cppcms::applications_factory<my_xss>());
        srv.run();
    }
    catch(std::exception const &e) {
        std::cerr<<e.what()<<std::endl;
    }
}
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \subsection{xss/config.js \-Configuration \-File}\label{ex_xss____config__js}

\begin{DoxyCodeInclude}
{
        "filters" : {
                //
                // Basic profile for example for blog comments
                //
                "profile" : "comment_profile.js"
                // 

                
                //
                // Profile for simple TinyMCE configuration with rich content.
                //
                // To use download TinyMCE and extract in this diectory,
                //
                // "tinymce" : true,
                // "profile" : "tinymce_profile.js",
                //

        },
        "service" : {
                "api" : "http",
        },
        "http" : {
                "script" : "/xss"
        },
        "file_server" : {
                "enable" : true
        }
}

\end{DoxyCodeInclude}
 \section{\-Using \-J\-S\-O\-N \-A\-P\-I}\label{ex_json}

\begin{DoxyItemize}
\item \doxyref{json/\-Makefile \-Makefile}{p.}{ex_json____Makefile}
\item \doxyref{json/json.\-cpp \-Source \-File}{p.}{ex_json____json__cpp} 
\end{DoxyItemize}\subsection{json/\-Makefile \-Makefile}\label{ex_json____Makefile}

\begin{DoxyCodeInclude}
LIBS=-lcppcms 


all: json

json: json.cpp
        $(CXX) $(CXXFLAGS) -O2 -Wall -g json.cpp -o json ${LIBS}

clean:
        rm -fr json
\end{DoxyCodeInclude}
 \subsection{json/json.cpp \-Source \-File}\label{ex_json____json__cpp}

\begin{DoxyCodeInclude}
#include <cppcms/json.h>
#include <iostream>
#include <sstream>

struct person {
    std::string name;
    double salary;
    std::vector<std::string> kids_names;
};

namespace cppcms {
    namespace json {

        //
        // We specilize cppcms::json::traits structure to convert
        // objects to and from json values
        //

        template<>
        struct traits<person> {
            // this function should throw
            // cppcms::json::bad_value_cast in case
            // of invalid or impossible conversion, 
            // this would give an easy way to substitute
            // a default value in case of fault
            static person get(value const &v)
            {
                person p;
                if(v.type()!=is_object)
                    throw bad_value_cast();
                
                p.name=v.get<std::string>("name");
                p.salary=v.get<double>("salary");
                p.kids_names=
                    v.get<std::vector<std::string> >("kids_names");
                // this works because generic vector and string specialized
                return p;
            }
            static void set(value &v,person const &in)
            {
                v.set("name",in.name);
                v.set("salary",in.salary);
                v.set("kids_names",in.kids_names);
            }
        };
    } // json
} // cppcms

int main()
{
    cppcms::json::value my_object;
    // Create object data
    my_object["name"]="Moshe";
    my_object["salary"]=1000.0;
    my_object["kids_names"][0]="Yossi";
    my_object["kids_names"][1]="Yonni";
    
    // this is additional data
    my_object["data"]["weight"]=85;
    my_object["data"]["height"]=1.80;

    // Get values using path.
    std::string name=my_object.get<std::string>("name");
    double salary = my_object.get<double>("salary");
    int weight = my_object.get<int>("data.weight");
    double height = my_object.get<double>("data.height");
    
    // get values using default value if not set
    std::string eyes_color = my_object.get("data.eyes_color","brown");

    // load person object from the object
    // using above traits
    person moshe = my_object.get_value<person>();

    // save person object to json object
    cppcms::json::value other = moshe;

    // write data to output
    std::cout << other << std::endl;

    // write data formatter nicely
    my_object.save(std::cout,cppcms::json::readable);

    // save object to stream and load it back
    std::stringstream tmp;
    tmp << my_object;
    cppcms::json::value reloaded;
    reloaded.load(tmp,true);
}



// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \section{\-Simple \-Json\-R\-P\-C example}\label{ex_json_rpc}

\begin{DoxyItemize}
\item \doxyref{json\-\_\-rpc/usingrpc.\-html \-Using \-Json\-R\-P\-C \-Object}{p.}{ex_json_rpc____usingrpc__html}
\item \doxyref{json\-\_\-rpc/rpc.\-cpp \-Source \-File}{p.}{ex_json_rpc____rpc__cpp}
\item \doxyref{json\-\_\-rpc/\-Makefile \-Makefile}{p.}{ex_json_rpc____Makefile}
\item \doxyref{json\-\_\-rpc/index.\-html \-Json\-R\-P\-C \-Client \-Using \-X\-M\-L\-Http\-Request}{p.}{ex_json_rpc____index__html}
\item \doxyref{json\-\_\-rpc/config.\-js \-Configuration \-File}{p.}{ex_json_rpc____config__js} 
\end{DoxyItemize}\subsection{json\-\_\-rpc/usingrpc.html \-Using \-Json\-R\-P\-C \-Object}\label{ex_json_rpc____usingrpc__html}

\begin{DoxyCodeInclude}
<html>
<head>
<script type="text/javascript" src="/scripts/json2.js"></script>
<script type="text/javascript" src="/scripts/jsonrpc.js"></script>
</head>
<body>
<script type="text/javascript">

var rpc = new JsonRPC('/rpc',['div','sum'], ['notify']);

function getX()
{
        return parseInt(document.getElementById('x').value);
}
function getY()
{
        return parseInt(document.getElementById('y').value);
}

function setResult(r)
{
        document.getElementById('result').innerHTML += r + '<br>';
}

function call() 
{
        var x = getX();
        var y = getY();
        //  Synchronous call
        
        /*      
        try {
                setResult(x+'/'+y+ '=' + rpc.div(x,y));
                setResult(x+'+'+y+ '=' + rpc.sum(x,y));
                rpc.notify('test');
        }
        catch(e) {
                setResult(e.message);
        }
        */

        // Asynchronous call
        
        
        rpc.div.on_error = function(e) { setResult(e.error); }
        rpc.div.on_result = function(r) { setResult(x + '/' + y + '=' + r ); }
        
        rpc.sum.on_error = function(e) { setResult(e.error); }
        rpc.sum.on_result = function(r) { setResult(x + '+' + y + '='  + r); }

        rpc.notify.on_error = function() { setResult('Notification error:' + e.
      error); }
        rpc.notify.on_result = function() { setResult('Notification Called'); }
        
        rpc.div(x,y);
        rpc.sum(x,y);
        rpc.notify('test');
        
        return false;
}
</script>
<p><a href="/">Using plain XMLHttpRequest</a></p>
<form onsubmit="return call();">
<p>
<input type="text" id="x" />
<input type="submit" value="?" />
<input type="text" id="y" /> = 
</p>
<p id="result"></p>
</form>
</body>
</html>

\end{DoxyCodeInclude}
 \subsection{json\-\_\-rpc/rpc.cpp \-Source \-File}\label{ex_json_rpc____rpc__cpp}

\begin{DoxyCodeInclude}
#include <cppcms/application.h>
#include <cppcms/service.h>
#include <cppcms/applications_pool.h>
#include <cppcms/rpc_json.h>


class json_service : public cppcms::rpc::json_rpc_server {
public:
    json_service(cppcms::service &srv) : cppcms::rpc::json_rpc_server(srv)
    {
        bind("sum",cppcms::rpc::json_method(&json_service::sum,this),
      method_role);
        bind("div",cppcms::rpc::json_method(&json_service::div,this),
      method_role);
        bind("notify",cppcms::rpc::json_method(&json_service::notify,this),
      notification_role);
        bind("both",cppcms::rpc::json_method(&json_service::both,this));
    }
    void sum(int x,int y)
    {
        std::cout << "Sum Called" << std::endl;
        return_result(x+y);
    }
    void div(int x,int y)
    {
        std::cout << "Div Called" << std::endl;
        if(y==0)
                return_error("Division by zero");
        else
                return_result(x/y);
    }
    void notify(std::string msg)
    {
        std::cout << "We got notification " << msg << std::endl;
    }
    void both(std::string msg)
    {
        if(notification())
            std::cout << "We got notification " << msg << std::endl;
        else
                return_result("call:"+msg);
    }
};

int main(int argc,char **argv)
{
    try {
        cppcms::service srv(argc,argv);
        srv.applications_pool().mount( 
      cppcms::applications_factory<json_service>());
        srv.run();
    }
    catch(std::exception const &e) {
        std::cerr << e.what() << std::endl;
        return 1;
    }
    return 0;
}

// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \subsection{json\-\_\-rpc/\-Makefile \-Makefile}\label{ex_json_rpc____Makefile}

\begin{DoxyCodeInclude}
LIBS=-lcppcms -lbooster


all: rpc

rpc: rpc.cpp
        $(CXX) $(CXXFLAGS) -O2 -Wall -g rpc.cpp -o rpc ${LIBS}

clean:
        rm -fr rpc rpc.exe cppcms_rundir
\end{DoxyCodeInclude}
 \subsection{json\-\_\-rpc/index.html \-Json\-R\-P\-C \-Client \-Using \-X\-M\-L\-Http\-Request}\label{ex_json_rpc____index__html}

\begin{DoxyCodeInclude}
<html>
<body>
<script type="text/javascript">
function call() {
        
        var xhr = new XMLHttpRequest();
        xhr.open("post", '/rpc');
        // Required by JSON-RPC over HTTP
        xhr.setRequestHeader("Content-Type","application/json");

        // It is better to use real formatter like JSON.js
        var x=parseInt(document.getElementById('x').value);
        var y=parseInt(document.getElementById('y').value);
        var request = '{"method":"div","params":[' + x + ',' + y +'],"id":1}';

        xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                        var res;
                        if(xhr.status === 200) {
                                // Don't call eval in real code use some parser
                                var result = eval('(' + xhr.responseText + ')')
      ;
                                if(result.error==null) {
                                        res = result.result;
                                }
                                else {
                                        res = result.error;
                                }
                        }
                        else {
                                res = 'Invalid Status ' + xhr.status;
                        }
                        document.getElementById('result').innerHTML = res;
                }
        }
        xhr.send(request); 
        return false;
}
</script>
<p><a href="usingrpc.html">Using jsonrpc.js</a></p>
<form onsubmit="return call();">
<p>
<input type="text" id="x" />
<input type="submit" value="/" />
<input type="text" id="y" /> = 
<span id="result"></span>
</p>
</form>
</body>
</html>

\end{DoxyCodeInclude}
 \subsection{json\-\_\-rpc/config.js \-Configuration \-File}\label{ex_json_rpc____config__js}

\begin{DoxyCodeInclude}
{
        "service" : {
                "api" : "http",
                "port" : 8080
        },
        "http" : {
                "script" : "/rpc"
        },
        "file_server" : { 
                "enable" : true,
                "alias" : [
                        { 
                                "url" : "/scripts" ,
                                "path" : "../../contrib/client_side/jsonrpc" 
                        }
                ]
        }
}

\end{DoxyCodeInclude}
 \section{\-Basic \-Comet \-Example}\label{ex_chat}

\begin{DoxyItemize}
\item \doxyref{chat/the\-\_\-chat.\-html \-Header \-File}{p.}{ex_chat____the_chat__html}
\item \doxyref{chat/\-Makefile \-Makefile}{p.}{ex_chat____Makefile}
\item \doxyref{chat/config.\-js \-Configuration \-File}{p.}{ex_chat____config__js}
\item \doxyref{chat/chat.\-cpp \-Source \-File}{p.}{ex_chat____chat__cpp} 
\end{DoxyItemize}\subsection{chat/the\-\_\-chat.html \-Header \-File}\label{ex_chat____the_chat__html}

\begin{DoxyCodeInclude}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <script type="text/javascript" src="
      http://o.aolcdn.com/dojo/1.3.0/dojo/dojo.xd.js"></script>
        <title>Chat Room</title>
</head>
<body>
<h1>Chat room</h1>
<script type="text/javascript">
        var message_count = 0;
        function send_data() {
                var kw = {
                        url : "/chat/post",
                        form : "theform"
                };
                dojo.xhrPost(kw);
                dojo.byId("message").value="";
                return false;
        }
        function read_data() {
                dojo.xhrGet( {
                        url: "/chat/get/" + message_count,
                        timeout: 10000,
                        handleAs: "text",
                        load: function(response, ioArgs) {
                                dojo.byId("messages").innerHTML = response + '
      <br/>' + dojo.byId("messages").innerHTML;
                                message_count++;
                                read_data();
                                return response;
                        },
                        error: function(response,ioArgs) {
                                read_data();
                                return response;
                        }

                });
        }
        dojo.addOnLoad(read_data);
</script>
<form id="theform" >
        <input id="message" type="text" name="message" value="" />
        <input type="submit" value="Send" onclick="return send_data()"/>
</form>
<div id="messages">
</div>
</body>
\end{DoxyCodeInclude}
 \subsection{chat/\-Makefile \-Makefile}\label{ex_chat____Makefile}

\begin{DoxyCodeInclude}
LIBS=-lcppcms -lbooster


all: chat

chat: chat.cpp
        $(CXX) $(CXXFLAGS) -O2 -Wall -g chat.cpp -o chat ${LIBS}

clean:
        rm -fr chat chat.exe cppcms_rundir
\end{DoxyCodeInclude}
 \subsection{chat/config.js \-Configuration \-File}\label{ex_chat____config__js}

\begin{DoxyCodeInclude}
{
        "service" : {
                "api" : "http",
                "port" : 8080
        },
        "http" : {
                "script" : "/chat"
        },
        "file_server" : {
                "enable" : true,
                "document_root" : "."
        },

}

\end{DoxyCodeInclude}
 \subsection{chat/chat.cpp \-Source \-File}\label{ex_chat____chat__cpp}

\begin{DoxyCodeInclude}

//                                                                             
//  Copyright (C) 2008-2012  Artyom Beilis (Tonkikh) <artyomtnk@yahoo.com>     
//                                                                             
//  See accompanying file COPYING.TXT file for licensing details.
//
#include <cppcms/application.h>
#include <cppcms/url_dispatcher.h>
#include <cppcms/applications_pool.h>
#include <cppcms/service.h>
#include <cppcms/http_response.h>
#include <cppcms/http_request.h>
#include <cppcms/http_context.h>
#include <booster/intrusive_ptr.h>

#include <set>

#ifdef USE_STD_TR1_BIND
  #include <tr1/functional>
  using std::tr1::bind;
#elif defined USE_STD_BIND
  #include <functional>
  using std::bind;
#else
  #include <boost/bind.hpp>
  using boost::bind;
#endif


class chat : public cppcms::application {
public:
    chat(cppcms::service &srv) : cppcms::application(srv)
    {
        dispatcher().assign("/post",&chat::post,this);
        dispatcher().assign("/get/(\\d+)",&chat::get,this,1);
        dispatcher().assign(".*",&chat::redirect,this);
    }
    void redirect()
    {
        response().set_redirect_header("/the_chat.html");
    }
    void post()
    {
        if(request().request_method()=="POST") {
            messages_.push_back(request().post("message"));
            broadcast();
        }
    }
    void get(std::string no)
    {
        unsigned pos=atoi(no.c_str());
        if(pos < messages_.size()) {
            response().set_plain_text_header();
            response().out()<<messages_[pos];
            return;
        }
        if(pos > messages_.size() ){
            response().status(404);
            return;
        }
        
        booster::shared_ptr<cppcms::http::context> context=release_context();
        waiters_.insert(context);
        context->async_on_peer_reset(
            bind(
                &chat::remove_context,
                booster::intrusive_ptr<chat>(this),
                context));
    }
    void remove_context(booster::shared_ptr<cppcms::http::context> context)
    {
        waiters_.erase(context);
    }
    void broadcast()
    {
        for(waiters_type::iterator it=waiters_.begin();it!=waiters_.end();++it)
       {
            booster::shared_ptr<cppcms::http::context> waiter = *it;

            waiter->response().set_plain_text_header();
            waiter->response().out() << messages_.back();
            waiter->async_complete_response();

        }
        waiters_.clear();
    }
private:
    std::vector<std::string> messages_;
    typedef std::set<booster::shared_ptr<cppcms::http::context> > waiters_type;
    waiters_type waiters_;
};


int main(int argc,char **argv)
{
    try {
        cppcms::service service(argc,argv);
        booster::intrusive_ptr<chat> c=new chat(service);
        service.applications_pool().mount(c);
        service.run();
    }
    catch(std::exception const &e) {
        std::cerr<<"Catched exception: "<<e.what()<<std::endl;
        return 1;
    }
    return 0;
}
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \section{\-Implementing chat using asynchronous \-J\-S\-O\-N \-R\-P\-C calls}\label{ex_json_rpc_chat}

\begin{DoxyItemize}
\item \doxyref{json\-\_\-rpc\-\_\-chat/\-Makefile \-Makefile}{p.}{ex_json_rpc_chat____Makefile}
\item \doxyref{json\-\_\-rpc\-\_\-chat/index.\-html \-Header \-File}{p.}{ex_json_rpc_chat____index__html}
\item \doxyref{json\-\_\-rpc\-\_\-chat/config.\-js \-Configuration \-File}{p.}{ex_json_rpc_chat____config__js}
\item \doxyref{json\-\_\-rpc\-\_\-chat/chat.\-cpp \-Source \-File}{p.}{ex_json_rpc_chat____chat__cpp} 
\end{DoxyItemize}\subsection{json\-\_\-rpc\-\_\-chat/\-Makefile \-Makefile}\label{ex_json_rpc_chat____Makefile}

\begin{DoxyCodeInclude}
LIBS=-lcppcms -lbooster


all: chat

chat: chat.cpp
        $(CXX) -O2 -Wall $(CXXFLAGS) -g chat.cpp -o chat ${LIBS}

clean:
        rm -fr chat chat.exe cppcms_rundir
\end{DoxyCodeInclude}
 \subsection{json\-\_\-rpc\-\_\-chat/index.html \-Header \-File}\label{ex_json_rpc_chat____index__html}

\begin{DoxyCodeInclude}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <script type="text/javascript" src="/scripts/json2.js"></script>
        <script type="text/javascript" src="/scripts/jsonrpc.js"></script>
        <title>Chat Room</title>

        <script type="text/javascript">
                // Global values:
                
                // RPC object with two methods:
                //
                // get(counter), returns array of objects with properties
       author and message
                // post(author,message) posts new chat message
                //
                rpc = new JsonRPC('/chat',['get'],['post']);
                // Messages counter - where to get new messages from, parameter
       for rpc.get
                message_count = 0;

                function make_error(what,e)
                {
                        document.getElementById('error_message').innerHTML = 
      what + ': ' + e.type +': ' + e.error;
                }

                rpc.get.on_result = function(messages) {
                        var messagesHtml = document.getElementById('messages');
                        
                        for(var i=0;i<messages.length;i++) {
                                m=messages[i];
                                messagesHtml.innerHTML+='<dt>' + m.author +'
      </dt>' +
                                        '<dd>' + m.message + '</dd>';
                                message_count++;
                        }

                        restart();
                }

                rpc.get.on_error = function(e) {
                        make_error('Getting New Messages',e);
                        document.getElementById('reconnect').disabled = false;
                }
         
                rpc.post.on_result = function() {
                        // reset the form content
                        document.getElementById("message").value = '';
                }
                rpc.post.on_error = function(e) {
                        make_error('Posting New Messages',e);
                }

                function restart()
                {
                        rpc.get(message_count);
                }
                
                function reconnect_to_server()
                {
                        message_count = 0;
                        document.getElementById('error_message').innerHTML = ''
      ;
                        document.getElementById('messages').innerHTML = '';
                        document.getElementById('reconnect').disabled = true;
                        restart();
                        return false;
                }
                
                function send_data() {
                        author = document.getElementById('author').value;
                        message = document.getElementById("message").value;
                        rpc.post(author,message);
                        return false;
                }
        </script>


</head>
<body onload='restart()'>
<h1>Chat room</h1>
<form id="theform" >
        <p>Name: <input id="author" type="text" value="" /></p>
        <p>
        Message: <input id="message" type="text" value="" /></p>
        <input type="submit" value="Send" onclick="return send_data()"/>
        <input disabled="disabled" id='reconnect' type='submit' value='
      Reconnect' onclick='return reconnect_to_server()'>
        </p>
        <p id='error_message'></p>
</form>
<dl id="messages">
</dl>
</body>
\end{DoxyCodeInclude}
 \subsection{json\-\_\-rpc\-\_\-chat/config.js \-Configuration \-File}\label{ex_json_rpc_chat____config__js}

\begin{DoxyCodeInclude}
{
        "service" : {
                "api" : "http",
                "port" : 8080
        },
        "http" : {
                "script" : "/chat"
        },
        "file_server" : {
                "enable" : true,
                "alias" : [
                        { 
                                "url" : "/scripts" ,
                                "path" : "../../contrib/client_side/jsonrpc" 
                        }
                ],
                "document_root" : "."
        },

}

\end{DoxyCodeInclude}
 \subsection{json\-\_\-rpc\-\_\-chat/chat.cpp \-Source \-File}\label{ex_json_rpc_chat____chat__cpp}

\begin{DoxyCodeInclude}

//                                                                             
//  Copyright (C) 2008-2012  Artyom Beilis (Tonkikh) <artyomtnk@yahoo.com>     
//                                                                             
//  See accompanying file COPYING.TXT file for licensing details.
//
#include <cppcms/application.h>
#include <cppcms/url_dispatcher.h>
#include <cppcms/applications_pool.h>
#include <cppcms/service.h>
#include <cppcms/http_response.h>
#include <cppcms/http_request.h>
#include <cppcms/http_context.h>
#include <cppcms/rpc_json.h>
#include <cppcms/json.h>
#include <booster/intrusive_ptr.h>
#include <booster/aio/deadline_timer.h>
#include <booster/system_error.h>

#include <set>

#include <boost/bind.hpp>
using boost::bind;


class chat : public cppcms::rpc::json_rpc_server {
public:
    chat(cppcms::service &srv) : 
        cppcms::rpc::json_rpc_server(srv),
        timer_(srv.get_io_service())
    {
        // Our main methods
        bind("post",cppcms::rpc::json_method(&chat::post,this),
      notification_role);
        bind("get",cppcms::rpc::json_method(&chat::get,this),method_role);
        
        // Add timeouts to the system
        last_wake_ = time(0);
        on_timer(booster::system::error_code());
    }

    // Handle new message call
    void post(std::string const &author,std::string const &message)
    {
        cppcms::json::value obj;
        obj["author"]=author;
        obj["message"]=message;
        messages_.push_back(obj);
        broadcast(messages_.size()-1);
    }

    void on_timer(booster::system::error_code const &e)
    {
        if(e) return; // cancelation

        // check idle connections for more then 10 seconds
        if(time(0) - last_wake_ > 10) {
            broadcast(messages_.size());
        }
        // restart timer
        timer_.expires_from_now(booster::ptime::seconds(1));
        timer_.async_wait(boost::bind(&chat::on_timer,
      booster::intrusive_ptr<chat>(this),_1));
    }

    // Handle request
    void get(unsigned from)
    {
        if(from < messages_.size()) {
            // not long polling - return result now
            return_result(make_response(from));
            return;
        }
        else if(from == messages_.size()) {
            // Can't answer now

            // Add long polling request to the list

            booster::shared_ptr<cppcms::rpc::json_call> call=release_call();
            waiters_.insert(call);

            // set disconnect callback
            call->context().async_on_peer_reset(
                boost::bind(
                    &chat::remove_context,
                    booster::intrusive_ptr<chat>(this),
                    call));
        }
        else {
            return_error("Invalid position");
        }
    }

    // handle client disconnect
    void remove_context(booster::shared_ptr<cppcms::rpc::json_call> call)
    {
        waiters_.erase(call);
    }

    void broadcast(size_t from)
    {
        // update timeout
        last_wake_ = time(0);
        // Prepare response
        cppcms::json::value response = make_response(from);
        // Send it to everybody
        for(waiters_type::iterator waiter=waiters_.begin();waiter!=waiters_.end
      ();++waiter) {
            booster::shared_ptr<cppcms::rpc::json_call> call = *waiter;
            call->return_result(response);
        }
        waiters_.clear();
    }

    // Prepare response to the client
    cppcms::json::value make_response(size_t n)
    {
        cppcms::json::value v;

        // Small optimization
        v=cppcms::json::array();
        cppcms::json::array &ar  = v.array();
        ar.reserve(messages_.size() - n);

        // prepare all messages
        for(size_t i=n;i<messages_.size();i++) {
            ar.push_back(messages_[i]);
        }
        return v;
    }
private:

    // message store
    std::vector<cppcms::json::value> messages_;

    // long poll requests
    typedef std::set<booster::shared_ptr<cppcms::rpc::json_call> > waiters_type
      ;
    waiters_type waiters_;

    // timer for resetting idle requests
    booster::aio::deadline_timer timer_;
    time_t last_wake_;
};


int main(int argc,char **argv)
{
    try {
        cppcms::service service(argc,argv);
        booster::intrusive_ptr<chat> c=new chat(service);
        service.applications_pool().mount(c);
        service.run();
    }
    catch(std::exception const &e) {
        std::cerr<<"Catched exception: "<<e.what()<<std::endl;
        return 1;
    }
    return 0;
}
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \section{\-Asynchonous \-I/\-O examples}\label{ex_aio}

\begin{DoxyItemize}
\item \doxyref{aio/\-Makefile \-Makefile}{p.}{ex_aio____Makefile}
\item \doxyref{aio/echo\-\_\-server.\-cpp \-Source \-File}{p.}{ex_aio____echo_server__cpp} 
\end{DoxyItemize}\subsection{aio/\-Makefile \-Makefile}\label{ex_aio____Makefile}

\begin{DoxyCodeInclude}
LIBS=-lbooster


all: echo_server

echo_server: echo_server.cpp
        $(CXX) $(CXXFLAGS) -std=c++0x -O2 -Wall -g echo_server.cpp -o 
      echo_server ${LIBS}

clean:
        rm -fr echo_server echo_server.exe cppcms_rundir
\end{DoxyCodeInclude}
 \subsection{aio/echo\-\_\-server.cpp \-Source \-File}\label{ex_aio____echo_server__cpp}

\begin{DoxyCodeInclude}
#include <booster/shared_ptr.h>
#include <booster/enable_shared_from_this.h>

#include <booster/aio/io_service.h>
#include <booster/aio/buffer.h>
#include <booster/aio/endpoint.h>
#include <booster/aio/acceptor.h>
#include <booster/aio/stream_socket.h>

#include <iostream>
#include <functional>


class echo_session : public booster::enable_shared_from_this<echo_session> {
public:
    echo_session(booster::aio::io_service &s) : socket_(s)
    {
    }

    void run()
    {
        socket_.async_read_some(
            booster::aio::buffer(buffer_,sizeof(buffer_)),
                std::bind(&echo_session::on_read,shared_from_this(),
                        std::placeholders::_1,
                        std::placeholders::_2));
                        
    }
    void on_read(booster::system::error_code const &e,size_t tr)
    {
        if(e) return;

        socket_.async_write(booster::aio::buffer(buffer_,tr),
                std::bind(&echo_session::on_written,shared_from_this(),
      std::placeholders::_1));
    }

    void on_written(booster::system::error_code const &e)
    {
        if(e) return;
        
        run();
    }
    
private:

    friend class echo_acceptor;

    char buffer_[1024];
    booster::aio::stream_socket socket_;
};


class echo_acceptor {
public:
    echo_acceptor(booster::aio::io_service &srv) : acceptor_(srv)
    {
        booster::aio::endpoint ep("0.0.0.0",8080);
        acceptor_.open(ep.family());
        acceptor_.set_option(booster::aio::acceptor::reuse_address,true);
        acceptor_.bind(ep);
        acceptor_.listen(10);
    }
    void run()
    {
        new_session_.reset(new echo_session(acceptor_.get_io_service()));
        acceptor_.async_accept(new_session_->socket_,
            std::bind(&echo_acceptor::on_accepted,this,std::placeholders::_1));
    }
    void on_accepted(booster::system::error_code const &e)
    {
        if(e) {
            std::cout << e.message() << std::endl;
            run();
        }
        else {
            new_session_->run();
            run();
        }
    }
private:
    booster::aio::acceptor acceptor_;
    booster::shared_ptr<echo_session> new_session_;
};


int main()
{
    try {
        booster::aio::io_service srv;

        #if !defined(_WIN32) && !defined(__CYGWIN__)
        booster::aio::basic_io_device stdin_device(srv);
        stdin_device.attach(0);
        std::cout << "Press any key to stop" << std::endl;
        stdin_device.on_readable(std::bind(&booster::aio::io_service::stop,&srv
      ));
        #endif

        echo_acceptor acc(srv);
        acc.run();

        srv.run();
    }
    catch(std::exception const &e) {
        std::cerr<<e.what()<<std::endl;
    }
}
// vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
\end{DoxyCodeInclude}
 \section{\-Full \-Message \-Board \-Application \-Example using \-Cache, \-Sessions, \-Cpp\-D\-B library and more}\label{ex_message_board}

\begin{DoxyItemize}
\item \doxyref{message\-\_\-board/model/sqlite3.\-sql \-S\-Q\-L \-Script \-File}{p.}{ex_message_board____model_sqlite3__sql}
\item \doxyref{message\-\_\-board/model/mysql.\-sql \-S\-Q\-L \-Script \-File}{p.}{ex_message_board____model_mysql__sql}
\item \doxyref{message\-\_\-board/apps/thread.\-h \-Header \-File}{p.}{ex_message_board____apps_thread__h}
\item \doxyref{message\-\_\-board/apps/forums.\-h \-Header \-File}{p.}{ex_message_board____apps_forums__h}
\item \doxyref{message\-\_\-board/apps/mb.\-h \-Header \-File}{p.}{ex_message_board____apps_mb__h}
\item \doxyref{message\-\_\-board/apps/master.\-cpp \-Source \-File}{p.}{ex_message_board____apps_master__cpp}
\item \doxyref{message\-\_\-board/apps/mb.\-cpp \-Source \-File}{p.}{ex_message_board____apps_mb__cpp}
\item \doxyref{message\-\_\-board/apps/master.\-h \-Header \-File}{p.}{ex_message_board____apps_master__h}
\item \doxyref{message\-\_\-board/apps/thread.\-cpp \-Source \-File}{p.}{ex_message_board____apps_thread__cpp}
\item \doxyref{message\-\_\-board/apps/forums.\-cpp \-Source \-File}{p.}{ex_message_board____apps_forums__cpp}
\item \doxyref{message\-\_\-board/apps/main.\-cpp \-Source \-File}{p.}{ex_message_board____apps_main__cpp}
\item \doxyref{message\-\_\-board/\-C\-Make\-Lists.\-txt \-C\-Make \-Build \-Script}{p.}{ex_message_board____CMakeLists__txt}
\item \doxyref{message\-\_\-board/media/style-\/ltr.\-css \-C\-S\-S \-Media \-File}{p.}{ex_message_board____media_style-ltr__css}
\item \doxyref{message\-\_\-board/media/style.\-css \-C\-S\-S \-Media \-File}{p.}{ex_message_board____media_style__css}
\item \doxyref{message\-\_\-board/media/style-\/rtl.\-css \-C\-S\-S \-Media \-File}{p.}{ex_message_board____media_style-rtl__css}
\item \doxyref{message\-\_\-board/view/thread.\-tmpl \-Template \-File}{p.}{ex_message_board____view_thread__tmpl}
\item \doxyref{message\-\_\-board/view/forums.\-tmpl \-Template \-File}{p.}{ex_message_board____view_forums__tmpl}
\item \doxyref{message\-\_\-board/view/master.\-tmpl \-Template \-File}{p.}{ex_message_board____view_master__tmpl}
\item \doxyref{message\-\_\-board/config.\-js \-Configuration \-File}{p.}{ex_message_board____config__js}
\item \doxyref{message\-\_\-board/data/thread.\-h \-Header \-File}{p.}{ex_message_board____data_thread__h}
\item \doxyref{message\-\_\-board/data/forums.\-h \-Header \-File}{p.}{ex_message_board____data_forums__h}
\item \doxyref{message\-\_\-board/data/data.\-h \-Header \-File}{p.}{ex_message_board____data_data__h}
\item \doxyref{message\-\_\-board/data/master.\-h \-Header \-File}{p.}{ex_message_board____data_master__h}
\item \doxyref{message\-\_\-board/locale/he/\-L\-C\-\_\-\-M\-E\-S\-S\-A\-G\-E\-S/mb.\-po \-Gettext \-Dictionary \-File}{p.}{ex_message_board____locale_he_LC_MESSAGES_mb__po} 
\end{DoxyItemize}\subsection{message\-\_\-board/model/sqlite3.sql \-S\-Q\-L \-Script \-File}\label{ex_message_board____model_sqlite3__sql}

\begin{DoxyCodeInclude}
begin;
drop table if exists threads;
drop table if exists messages;

create table threads (
    id integer primary key autoincrement not null,
    title varchar(256) not null
);

create table messages (
    id integer primary key autoincrement not null,
    reply_to integer not null,
    thread_id integer not null,
    author varchar(256) not null,
    content text not null
);

commit;
\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/model/mysql.sql \-S\-Q\-L \-Script \-File}\label{ex_message_board____model_mysql__sql}

\begin{DoxyCodeInclude}
drop table if exists threads;
drop table if exists messages;

create table threads (
        id integer auto_increment primary key not null,
        title varchar(256) not null
) Engine = InnoDB;

create table messages (
        id integer auto_increment primary key not null,
        reply_to integer not null,
        thread_id integer not null,
        author varchar(256) not null,
        content text not null
) Engine = InnoDB;


\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/apps/thread.h \-Header \-File}\label{ex_message_board____apps_thread__h}

\begin{DoxyCodeInclude}
#ifndef APPS_THREAD_H
#define APPS_THREAD_H
#include <cppcms/application.h>
#include <string>

#include <apps/master.h>
#include <data/thread.h>

namespace apps {

class thread_shared : public master
{
public:
        thread_shared(cppcms::service &s);
        bool prepare(data::thread_shared &c,int id);

};

class flat_thread : public thread_shared {
public:

        flat_thread(cppcms::service &s);
        void prepare(std::string id); 
};

class tree_thread : public thread_shared {
public:

        tree_thread(cppcms::service &s);
        void prepare(std::string id);
};

typedef data::tree_t tree_t;

class reply : public thread_shared {
public:

        reply(cppcms::service &s);
        void prepare(std::string id);
};


} // apps


#endif
\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/apps/forums.h \-Header \-File}\label{ex_message_board____apps_forums__h}

\begin{DoxyCodeInclude}
#ifndef APPS_FORUMS_H
#define APPS_FORUMS_H
#include <cppcms/application.h>

#include <apps/master.h>
#include <data/forums.h>

namespace apps {


        class forums : public master{
        public:
                
                forums(cppcms::service &s);
                void prepare(std::string page);
        private:
                void prepare_content(data::forums &c,std::string const &page);
        };

}

#endif
\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/apps/mb.h \-Header \-File}\label{ex_message_board____apps_mb__h}

\begin{DoxyCodeInclude}
#ifndef MB_H
#define MB_H

#include <cppcms/application.h>

namespace apps {

class mb : public cppcms::application {
public:

        mb(cppcms::service &s);

};


}


#endif
\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/apps/master.cpp \-Source \-File}\label{ex_message_board____apps_master__cpp}

\begin{DoxyCodeInclude}
#include "master.h"

#include <cppcms/json.h>
#include <cppcms/session_interface.h>
#include <cppcms/url_mapper.h>
#include <iostream>

namespace apps {

master::master(cppcms::service &srv) : cppcms::application(srv)
{       
        conn_str_ = settings().get<std::string>("mb.connection_string");
        media_=settings().get<std::string>("mb.media");
}

void master::init()
{
        sql.open(conn_str_);
        if(!session().is_set("view") || session()["view"]=="tree") {
                parent()->mapper().set_value("method","tree");
        }
        else {
                parent()->mapper().set_value("method","flat");
        }
}
void master::clear()
{
        sql.close();
}

void master::prepare(data::master &c)
{
        c.media=media_;
}


} // namespace apps
\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/apps/mb.cpp \-Source \-File}\label{ex_message_board____apps_mb__cpp}

\begin{DoxyCodeInclude}
#include <apps/mb.h>
#include <apps/forums.h>
#include <apps/thread.h>
#include <cppcms/url_dispatcher.h>
#include <cppcms/url_mapper.h>
#include <cppcms/json.h>



namespace apps {


mb::mb(cppcms::service &s) : cppcms::application(s)
{

        attach( new forums(s),
                "forums",
                "/{1}",
                "(/(\\d+)?)?",2);

        attach( new flat_thread(s),
                "flat_thread",
                "/flat/{1}",
                "/flat/(\\d+)",1);


        attach( new tree_thread(s),
                "tree_thread",
                "/tree/{1}",
                "/tree/(\\d+)",1);

        attach( new reply(s),
                "comment",
                "/comment/{1}",
                "/comment/(\\d+)",1);
        
        // Generic mapping
        mapper().root(settings().get<std::string>("mb.root"));
        mapper().assign("user_thread","/{method}/{1}");
}

} // apps
\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/apps/master.h \-Header \-File}\label{ex_message_board____apps_master__h}

\begin{DoxyCodeInclude}
#ifndef APPS_MASTER_H
#define APPS_MASTER_H
#include <cppcms/application.h>
#include <cppdb/frontend.h>

#include <data/master.h>

namespace apps {

class master: public cppcms::application {
public:

        master(cppcms::service &w);
        virtual void init();
        virtual void clear();

protected:
        void prepare(data::master &c);
        cppdb::session sql;
private:
        std::string conn_str_;
        std::string media_;
};


}


#endif
\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/apps/thread.cpp \-Source \-File}\label{ex_message_board____apps_thread__cpp}

\begin{DoxyCodeInclude}
#include <apps/thread.h>
#include <cppcms/util.h>
#include <cppcms/url_dispatcher.h>
#include <cppcms/url_mapper.h>
#include <cppcms/session_interface.h>
#include <cppcms/cache_interface.h>



namespace data {

reply_form::reply_form()
{
        using cppcms::locale::translate;
        author.message(translate("Author"));
        comment.message(translate("Comment"));
        send.value(translate("Send"));
        add(author);
        add(comment);
        add(send);
        author.limits(1,64);
        comment.limits(1,256);
}


} // data

namespace {
        std::string text2html(std::string const &s)
        {
                std::string tmp=cppcms::util::escape(s);
                std::string res;
                res.reserve(tmp.size());
                for(unsigned i=0;i<tmp.size();i++) {
                        if(tmp[i]=='\n') {
                                res+="<br />";
                        }
                        res+=tmp[i];
                }
                return res;
        }
}


namespace apps {

thread_shared::thread_shared(cppcms::service &s) : apps::master(s)
{
}


bool thread_shared::prepare(data::thread_shared &c,int id)
{
        master::prepare(c);
        c.thread_id = id;
        

        cppdb::result r;
        r=sql<<"SELECT title FROM threads WHERE id=?" << id << cppdb::row;
        if(r.empty()) {
                response().make_error_response(404);
                return false;
        }
        
        r>> c.title;
        c.text2html = text2html;
        return true;

}

flat_thread::flat_thread(cppcms::service &s) : thread_shared(s)
{
        dispatcher().assign(".*",&flat_thread::prepare,this,0);
        mapper().assign("{1}");
}


void flat_thread::prepare(std::string sid)
{
        std::string key = "flat_thread_" + sid;
        
        if(cache().fetch_page(key))
                return;

        cache().add_trigger("thread_" + sid);
        
        data::flat_thread c;
        int id = atoi(sid.c_str());
        if(!thread_shared::prepare(c,id))
                return;
        cppdb::result r;
        r=sql<< "SELECT id,author,content "
                "FROM messages WHERE thread_id=? "
                "ORDER BY id" << id;
        
        c.messages.reserve(10);
        for(int i=0;r.next();i++) {
                c.messages.resize(i+1);
                r>>c.messages[i].msg_id>>c.messages[i].author>>c.messages[i].
      content;
        }
        session()["view"]="flat";
        render("flat_thread",c);

        cache().store_page(key);
}

typedef std::map<int,std::map<int,data::msg> > msg_ord_t;

namespace {

void make_tree(data::tree_t &messages,std::map<int,std::map<int,data::msg> > &
      content,int start)
{
        std::pair<msg_ord_t::iterator,msg_ord_t::iterator>
                range=content.equal_range(start);
        for(msg_ord_t::iterator p=range.first;p!=range.second;++p) {
                for(std::map<int,data::msg>::iterator p2=p->second.begin(),e=p
      ->second.end();p2!=e;++p2) {
                        data::tree_thread::tree_msg &m=messages[p2->first];
                        m.author=p2->second.author;
                        m.content=p2->second.content;
                        m.msg_id=p2->second.msg_id;
                        make_tree(m.repl,content,p2->first);
                }
        }
        
}

} // anon

tree_thread::tree_thread(cppcms::service &s) : thread_shared(s)
{
        dispatcher().assign(".*",&tree_thread::prepare,this,0);
        mapper().assign("{1}");
}



void tree_thread::prepare(std::string sid)
{
        std::string key = "tree_thread_" + sid;
        
        if(cache().fetch_page(key))
                return;

        cache().add_trigger("thread_" + sid);

        int id = atoi(sid.c_str());
        data::tree_thread c;
        if(!thread_shared::prepare(c,id))
                return;
        cppdb::result r;
        r=sql<< "SELECT reply_to,id,author,content "
                "FROM messages WHERE thread_id=? "
                "ORDER BY reply_to,id DESC" << id;
        msg_ord_t all;
        while(r.next()) {
                int msg_id,rpl_id;
                std::string author,comment;
                r>>rpl_id>>msg_id;
                data::msg &message=all[rpl_id][msg_id];
                r>>message.author>>message.content;
                message.msg_id=msg_id;
        }
        
        make_tree(c.messages,all,0);

        session()["view"]="tree";
        render("tree_thread",c);

        cache().store_page(key);
}

reply::reply(cppcms::service &srv) : thread_shared(srv)
{
        dispatcher().assign(".*",&reply::prepare,this,0);
        mapper().assign("{1}");
}

void reply::prepare(std::string smid)
{
        int mid;
        mid=atoi(smid.c_str());

        data::reply c;
        
        if(request().request_method()=="POST") {
                c.form.load(context());
                if(c.form.validate()) {
                        cppdb::transaction tr(sql);
                        cppdb::result r;
                        r=sql<<"SELECT thread_id FROM messages WHERE id=?" << 
      mid << cppdb::row;
                        if(r.empty()) {
                                response().make_error_response(404);
                                return;
                        }
                        int tid = r.get<int>(0);
                        // we want this as string for trigger
                        std::string stid = r.get<std::string>(0);
                        r.clear();
                        sql<<   "INSERT INTO
       messages(reply_to,thread_id,author,content) "
                                "VALUES(?,?,?,?) " 
                                << mid << tid << c.form.author.value() << c.
      form.comment.value() 
                                << cppdb::exec;

                        cache().rise("thread_" + stid);
                        tr.commit();

                        response().set_redirect_header(url("/user_thread",tid))
      ;
                        return;
                }
        }

        cppdb::result r;
        r=sql<< "SELECT threads.id,author,content,title "
                "FROM messages "
                "JOIN threads ON thread_id=threads.id "
                "WHERE messages.id=?" << mid << cppdb::row;
        if(r.empty()) {
                response().make_error_response(404);
                return;
        }

        int tid;

        r>>tid>>c.author>>c.content>>c.title;
        c.thread_id = tid;
        c.msg_id = mid;
        
        if(!thread_shared::prepare(c,tid))
                return;

        render("reply",c);
}

} // namespace apps
\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/apps/forums.cpp \-Source \-File}\label{ex_message_board____apps_forums__cpp}

\begin{DoxyCodeInclude}
#include "forums.h"
#include <cppcms/url_dispatcher.h>
#include <cppcms/url_mapper.h>
#include <cppcms/session_interface.h>
#include <cppcms/cache_interface.h>
#include <boost/lexical_cast.hpp>

namespace data {

new_topic_form::new_topic_form() 
{
        using cppcms::locale::translate;
        title.message(translate("Title"));
        author.message(translate("Author"));
        comment.message(translate("Comment"));
        submit.value(translate("Create"));
        add(title);
        add(author);
        add(comment);
        add(submit);
        title.non_empty();
        author.limits(1,64);
        comment.limits(1,256);
}

} // data

namespace apps {

forums::forums(cppcms::service &srv) : master(srv)
{
        mapper().assign("{1}"); // with id
        mapper().assign("");    // default
        dispatcher().assign(".*",&forums::prepare,this,0);
}

void forums::prepare_content(data::forums &c,std::string const &page)
{
        master::prepare(c);
        
        const unsigned topics_per_page=10;
        int offset= page.empty() ? 0 : atoi(page.c_str());
        
        cppdb::result r;

        r=sql<< "SELECT id,title "
                "FROM threads "
                "ORDER BY id DESC "
                "LIMIT ?,?" << offset*topics_per_page << topics_per_page;
        
        c.topics.reserve(topics_per_page);      
        
        for(int i=0;r.next();i++) {
                c.topics.resize(c.topics.size()+1);
                r>>c.topics[i].id>>c.topics[i].title;
        }
        if(c.topics.size()==topics_per_page) {
                c.next=offset+1;
        }
        else {
                c.next = 0;
        }
        if(offset>0) {
                c.prev=offset-1;
        }
        else {
                c.prev = 0;
        }
        render("forums",c);
}

void forums::prepare(std::string page)
{
        if(request().request_method()=="POST") {
                data::forums c;

                c.form.load(context());
                if(c.form.validate()) {
                        cppdb::transaction tr(sql);
                        cppdb::statement st;
                        st= sql <<"INSERT INTO threads(title) VALUES(?)" 
                                << c.form.title.value() << cppdb::exec;
                        int id=st.last_insert_id();
                        sql<<   "INSERT INTO
       messages(thread_id,reply_to,content,author) "
                                "VALUES (?,0,?,?)"
                                << id << c.form.comment.value() << c.form.
      author.value() << cppdb::exec;
                        
                        // We need to invalidate all pages on new post
                        cache().rise("new_thread");
                        tr.commit();

                        response().set_redirect_header(url("/user_thread",id));
                        return;
                }
                else {
                        prepare_content(c,page);
                }
        }
        else {
                std::string key = "main_page_" + page;
                if(cache().fetch_page(key))
                        return;
                // Add some shared key for all main_page_
                cache().add_trigger("new_thread");
                
                data::forums c;
                prepare_content(c,page);

                cache().store_page(key);

        }
        
}


} // namespace apps
\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/apps/main.cpp \-Source \-File}\label{ex_message_board____apps_main__cpp}

\begin{DoxyCodeInclude}
#include <apps/mb.h>
#include <cppcms/service.h>
#include <cppcms/applications_pool.h>

#include <iostream>

int main(int argc,char ** argv)
{
        try {

                cppcms::service app(argc,argv);
                app.applications_pool().mount(
      cppcms::applications_factory<apps::mb>());
                app.run();
        }
        catch(std::exception const &e) {
                std::cerr<<e.what()<<std::endl;
        }
}

\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/\-C\-Make\-Lists.txt \-C\-Make \-Build \-Script}\label{ex_message_board____CMakeLists__txt}

\begin{DoxyCodeInclude}
cmake_minimum_required(VERSION 2.6)
project(cppcms)

include_directories(${CMAKE_SOURCE_DIR})

# Options 

option(STATIC_VIEW "Build Static View instead of dynamically loaded one" OFF)

if(WIN32 OR CYGWIN)
        add_definitions(-DDLL_EXPORT)
endif()


# Dependencies

find_library(LIB_BOOSTER booster)
find_library(LIB_CPPCMS cppcms)
find_library(LIB_CPPDB cppdb)
find_program(EXE_TMPL_CC cppcms_tmpl_cc)
find_program(EXE_MSGFMT msgfmt)
find_program(EXE_SQLITE3 sqlite3)

find_path(INC_BOOSTER booster/config.h)
find_path(INC_CPPCMS cppcms/config.h)
find_path(INC_CPPDB cppdb/frontend.h)

# Sources

set(VIEW_NAME simple)

set(VIEW_TEMPLATES 
        view/master.tmpl
        view/forums.tmpl 
        view/thread.tmpl)

set(MB_SRC
        apps/master.cpp
        apps/thread.cpp
        apps/forums.cpp
        apps/mb.cpp
        apps/main.cpp)

set(MB_LANG he)

# Actual Build

include_directories(${INC_BOOSTER})
include_directories(${INC_CPPCMS})
include_directories(${INC_CPPDB})

set(VIEW_SRC "${CMAKE_CURRENT_BINARY_DIR}/${VIEW_NAME}.cpp")

add_custom_command(
        OUTPUT ${VIEW_SRC}
        COMMAND ${EXE_TMPL_CC}
                -s "${VIEW_NAME}"
                ${TMPL_CC_PARAMS}
                -o ${VIEW_SRC}
                ${VIEW_TEMPLATES}
        WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
        DEPENDS ${VIEW_TEMPLATES})


if(STATIC_VIEW)
        set(MB_SRC ${MB_SRC} ${VIEW_SRC})
else()
        add_library(${VIEW_NAME} SHARED ${VIEW_SRC})
        target_link_libraries(${VIEW_NAME} ${LIB_CPPCMS})
        target_link_libraries(${VIEW_NAME} ${LIB_BOOSTER})
endif()


add_executable(mb ${MB_SRC})
target_link_libraries(mb ${LIB_CPPCMS})
target_link_libraries(mb ${LIB_BOOSTER})
target_link_libraries(mb ${LIB_CPPDB})

if(EXE_MSGFMT)
        set(MO_FILES)
        foreach(LANG ${MB_LANG}) 
                set(PO locale/${LANG}/LC_MESSAGES/mb.po)
                set(MO ${CMAKE_CURRENT_BINARY_DIR}/locale/${LANG}/LC_MESSAGES/
      mb.mo)
                file(MAKE_DIRECTORY "
      ${CMAKE_CURRENT_BINARY_DIR}/locale/${LANG}/LC_MESSAGES")
                set(MO_FILES ${MO_FILES} ${MO})
                add_custom_command(
                        OUTPUT ${MO}
                        COMMAND ${EXE_MSGFMT} ${PO} -o ${MO}
                        WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
                        DEPENDS ${PO})
        endforeach()
        add_custom_target(create-mo ALL DEPENDS ${MO_FILES})
else()
        message("-- msgfmt not found, translations not generatied")
endif()

if(EXE_SQLITE3)
        add_custom_command(
                OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/mb.db
                COMMAND ${EXE_SQLITE3} < ${CMAKE_CURRENT_SOURCE_DIR}/model/
      sqlite3.sql ${CMAKE_CURRENT_BINARY_DIR}/mb.db)
        add_custom_target(sqlitedb ALL DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/mb.
      db)
endif()
\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/media/style-\/ltr.css \-C\-S\-S \-Media \-File}\label{ex_message_board____media_style-ltr__css}

\begin{DoxyCodeInclude}
#links { float:left }
#body { float:right }
body { direction:ltr }

\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/media/style.css \-C\-S\-S \-Media \-File}\label{ex_message_board____media_style__css}

\begin{DoxyCodeInclude}
#page {
        width:750px;
        margin:20px auto;
        padding-left:10px;
        padding-right:10px;
}

#links {
        width:180px;
}

#body {
        width:540px;
}
\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/media/style-\/rtl.css \-C\-S\-S \-Media \-File}\label{ex_message_board____media_style-rtl__css}

\begin{DoxyCodeInclude}
#links { float:right }
#body { float:left }
body { direction:rtl }

\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/view/thread.tmpl \-Template \-File}\label{ex_message_board____view_thread__tmpl}

\begin{DoxyCodeInclude}
<% skin %>

<% view base_thread uses data::thread_shared  extends master %>

<% template msg_header(data::msg &m) %>
        <%= m.author %>, <a href="<% url "/comment" using m.msg_id %>"><% gt "
      reply" %></a>
<% end %>

<% template msg_cnt(data::msg  &m) %>
<p><%= m.content | ext text2html %></p>
<% end %>

<% template msg(data::msg &m) %>
<dt><% include msg_header(m) %></dt>
<dd><% include msg_cnt(m) %></dd>
<% end %>

<% template title() %><% gt "Disussion: {1}" using title %><% end template %>

<% template links() %>
<% include master::links() %>
        <p>
                <a href="<% url "/flat_thread" using thread_id %>"><% gt "Flat
       View"%></a>
                | <a href="<% url "/tree_thread" using thread_id %>"><% gt "
      Tree View" %></a>
        </p>
<% end %>

<% end view %>


<% view flat_thread uses data::flat_thread  extends base_thread %>

<% template body() %>
        <% foreach message in messages %>
                <dl>
                <% item %><% include msg(message) %><% end %>
                </dl>
        <% empty %>
                <h2><% gt "There are no comments." %></h2>
        <% end %>
<% end template %>

<% end view %>


<% view tree_thread uses data::tree_thread  extends base_thread %>

<% template display(data::tree_t &tree) %>
        <% foreach message in tree %>
                <dl>
                <% item %>
                        <dt><% include msg_header(message.second) %></dt>
                        <dd>
                                <% include msg_cnt(message.second) %>
                                <% include display(message.second.repl) %>
                        </dd>
                <% end %>
                </dl>
        <% end %>
<% end template %>

<% template body() %>
        <% if empty messages %>
                <h2><% gt "There are no comments." %></h2>
        <% else %>
                <% include display(messages) %>
        <% end %>
<% end template %>

<% end view %>


<% view reply uses data::reply extends master %>

<% template title() %><% gt "Comment to thread: {1}" using title %><% end %>

<% template links() %>
        <% include master::links() %>
        <p><a href="<% url "/user_thread" using thread_id %>"><% gt "Back to
       thread" %></a></p>
<% end %>

<% template body() %>
        <% if not empty content %>
                <dl>
                        <dt><%= author %></dt>
                        <dd><%= content | ext text2html %></dd>
                </dl>
        <% end %>
        <form action="" method="post" ><% csrf %>
        <table>
                <% form as_table form.author %>
                <tr>
                        <th>
                        <%= form.comment.message() %>: 
                        <% if form.comment.valid() %>
                                <%= form.comment.error_message() %>
                        <% end %>
                        </th>
                        <td>
                        <% form begin form.comment %> rows="24" cols="80" <% 
      form end form.comment %> 
                        </td>
                </tr>
                <% form as_table form.send %>
        </table>
        </form>
<% end template %>

<% end view %>

<% end skin %>

\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/view/forums.tmpl \-Template \-File}\label{ex_message_board____view_forums__tmpl}

\begin{DoxyCodeInclude}
<% skin %>
<% view forums uses data::forums  extends master %>
<% template body() %>
        <% foreach topic in topics %>
                <ul>
                <% item %>
                <li><a href="<% url "/user_thread" using topic.id %>"><%= topic
      .title %></a></li>
                <% end %>
                </ul>
        <% empty %>
                <h2><% gt "No Topics" %></h2>
        <% end %>
        <h2><% gt "Create New Disussion" %></h2>
        <form action="<% url "/forums" %>" method="post" ><% csrf script %>
        <% form as_p form %>
        </form>
<% end template %>

<% template links() %>
        <% include master::links() %>
        <p>
        <% if next %>
        <a href="<% url "/forums" using next %>"><% gt "Next Page" %></a>
        <% end %>
        <% if prev %>
        <a href="<% url "/forums" using prev  %>"><% gt "Prev Page" %></a>
        <% end %>
        </p>
<% end template %>


<% end view %>
<% end skin %>
\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/view/master.tmpl \-Template \-File}\label{ex_message_board____view_master__tmpl}

\begin{DoxyCodeInclude}
<% c++ #include "data/data.h" %>
<% xhtml %>
<% skin %>
<% view master uses data::master %>

<% template title() %><% gt "Welcome to the Message Board"  %><% end template %
      >

<% template header() %>
<title><% include title() %></title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="<%= media %>/style.css" rel="stylesheet" type="text/css" />
<link href="<%= media %>/style-<% if rtl %>rtl<% else %>ltr<%end%>.css" rel="
      stylesheet" type="text/css" />
<% end template %>

<% template render() %>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<% include header() %>
</head>
<body>
        <div id="page">
                <div id="links">
                        <% include links() %>
                </div>
                <div id="body">
                        <h1><% include title() %></h1>
                        <% include body() %>
                </div>
        </div>
</body>
</html>
<% end template %>

<% template body() %><% end %>
<% template links() %>
<p><a href="<% url "/forums" %>"><% gt "Home" %></a></p>
<% end %>
<% end view %>
<% end skin %>

\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/config.js \-Configuration \-File}\label{ex_message_board____config__js}

\begin{DoxyCodeInclude}
{
        
        "mb" : {
                "media" : "/media",
                "root" : "",
                "connection_string" : "sqlite3:db=mb.db;@pool_size=10"
                //"connection_string" :
       "mysql:database=test;user=root;password=root;@pool_size=10"
        },
        "service" : {
                "api" : "http",
                "port" : 8080
        },
        "http" : {
                "script" : "/mb",
                "rewrite" : [
                        { "regex" : "/media(/.*)?", "pattern" : "$0" },
                        { "regex" : "/favion\\.ico", "pattern" : "$0" },
                        { "regex" : ".*" , "pattern" : "/mb$0" }
                ]
        },
        "views" : {
                 "paths" : [ "./" ],
                 "skins" : [ "simple" ],
        },
        "file_server" : {
                "enable" : true,
                "document_root" : "../"
        },
        "session" : {
                "expire" : "renew",
                "timeout" : 604800,
                "location" : "client",
                "client" : {
                        "hmac" : "sha1",
                        "hmac_key" : "232074faa0fd37de20858bf8cd0a7d04"
                }
        },
        "cache" : {
                "backend" : "thread_shared",
                "limit" : 100,
        },
        "security" : {
                "csrf" : {
                        "enable" : true,
                        "exposed" : true
                }
        },
        "localization" : {
                "messages" : {
                        "paths" : [ "./locale" ],
                        "domains" : [ "mb" ]
                },
                "locales" : [ 
                        "en_US.UTF-8",
                        "he_IL.UTF-8"
                ]
        }
}
\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/data/thread.h \-Header \-File}\label{ex_message_board____data_thread__h}

\begin{DoxyCodeInclude}
#ifndef DATA_THREAD_H
#define DATA_THREAD_H
#include <string>

#include <data/master.h>
#include <booster/function.h>

namespace data {

struct reply_form : public cppcms::form {
        cppcms::widgets::text author;
        cppcms::widgets::textarea comment;
        cppcms::widgets::submit send;
        reply_form();
};


struct msg {
        std::string author;
        std::string content;
        int msg_id;
        msg() : msg_id(0) {}
};


class thread_shared : public master
{
public:
        thread_shared() 
        {
                thread_id = 0;
        }
        int thread_id;
        std::string title;
        std::string (*text2html)(std::string const &);

};

class flat_thread : public thread_shared {
public:
        std::vector<msg> messages;

};

class tree_thread : public thread_shared {
public:
        struct tree_msg : public msg {
                typedef std::map<int,tree_msg> tree_t;
                tree_t repl;
        };
        tree_msg::tree_t messages;

};

typedef tree_thread::tree_msg::tree_t tree_t;

class reply : public thread_shared , public msg {
public:
        reply_form form;

};


} // data


#endif
\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/data/forums.h \-Header \-File}\label{ex_message_board____data_forums__h}

\begin{DoxyCodeInclude}
#ifndef DATA_FORUMS_H
#define DATA_FORUMS_H

#include <data/master.h>

namespace data {

        struct new_topic_form : public cppcms::form {
                cppcms::widgets::text title;
                cppcms::widgets::text author;
                cppcms::widgets::textarea comment;
                cppcms::widgets::submit submit;
                new_topic_form();
        };


        class forums : public master{
        public:
                forums() : next(0),prev(0) {}
                struct topic {
                        topic() : id(0) {}
                        std::string title;
                        int id;
                };
                std::vector<topic> topics;
                int next,prev;
                new_topic_form form;
        };

}

#endif
\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/data/data.h \-Header \-File}\label{ex_message_board____data_data__h}

\begin{DoxyCodeInclude}
#ifndef DATA_H
#define DATA_H

#include <data/forums.h>
#include <data/thread.h>

#endif

\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/data/master.h \-Header \-File}\label{ex_message_board____data_master__h}

\begin{DoxyCodeInclude}
#ifndef DATA_MASTER_H
#define DATA_MASTER_H
#include <cppcms/view.h>

namespace data {

        class master: public cppcms::base_content {
        public:
                std::string media;
        };


}


#endif
\end{DoxyCodeInclude}
 \subsection{message\-\_\-board/locale/he/\-L\-C\-\_\-\-M\-E\-S\-S\-A\-G\-E\-S/mb.po \-Gettext \-Dictionary \-File}\label{ex_message_board____locale_he_LC_MESSAGES_mb__po}

\begin{DoxyCodeInclude}
# Copyright (C) Artyom Beilis
# This file is distributed under the same license as the mb package.
#
msgid ""
msgstr ""
"Report-Msgid-Bugs-To: \n"
"POT-Creation-Date: 2010-01-14 16:22+0200\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=utf-8\n"
"Content-Transfer-Encoding: 8bit\n"

#: src/forums.cpp:15
msgid "Title"
msgstr "כותרת"

#: src/forums.cpp:16 src/thread.cpp:16
msgid "Author"
msgstr "מחבר"

#: src/forums.cpp:17 src/thread.cpp:17
msgid "Comment"
msgstr "הערה"

#: src/forums.cpp:18
msgid "Create"
msgstr "צור"

#: src/thread.cpp:18
msgid "Send"
msgstr "שלח"

#: master.tmpl:5
msgid "Welcome to the Message Board"
msgstr "ברוכים הבאים ללוח מודעות"

#: master.tmpl:11
msgid "LTR"
msgstr "RTL"

#: master.tmpl:37
msgid "Home"
msgstr "בית"

#: forums.tmpl:11
msgid "No Topics"
msgstr "אין דיונים"

#: forums.tmpl:13
msgid "Create New Disussion"
msgstr "צור דיון "

#: forums.tmpl:23
msgid "Next Page"
msgstr "הדף הבא"

#: forums.tmpl:26
msgid "Prev Page"
msgstr "הדף הקודם"

#: thread.tmpl:6
msgid "reply"
msgstr "הגב"

#: thread.tmpl:18
msgid "Disussion: {1}"
msgstr "דיון: {1}"

#: thread.tmpl:23
msgid "Flat View"
msgstr "מבנה סדרתי"

#: thread.tmpl:24
msgid "Tree View"
msgstr "מבנה עץ"

#: thread.tmpl:39 thread.tmpl:64
msgid "There is no comments"
msgstr "אין הערות"

#: thread.tmpl:75
msgid "Comment to thread: {1}"
msgstr "הגב לדיון {1}"

#: thread.tmpl:79
msgid "Back to thread"
msgstr "בחזרה לדיון"
\end{DoxyCodeInclude}
 